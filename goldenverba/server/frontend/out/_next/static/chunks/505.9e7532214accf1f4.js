(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[505],{77625:function(e){"use strict";var t=Object.prototype.hasOwnProperty,i="~";function r(){}function a(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function s(e,t,r,s,n){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new a(r,s||e,n),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function n(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(i=!1)),o.prototype.eventNames=function(){var e,r,a=[];if(0===this._eventsCount)return a;for(r in e=this._events)t.call(e,r)&&a.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(e)):a},o.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var a=0,s=r.length,n=Array(s);a<s;a++)n[a]=r[a].fn;return n},o.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,a,s,n){var o=i?i+e:e;if(!this._events[o])return!1;var l,u,h=this._events[o],d=arguments.length;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),d){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,t),!0;case 3:return h.fn.call(h.context,t,r),!0;case 4:return h.fn.call(h.context,t,r,a),!0;case 5:return h.fn.call(h.context,t,r,a,s),!0;case 6:return h.fn.call(h.context,t,r,a,s,n),!0}for(u=1,l=Array(d-1);u<d;u++)l[u-1]=arguments[u];h.fn.apply(h.context,l)}else{var c,p=h.length;for(u=0;u<p;u++)switch(h[u].once&&this.removeListener(e,h[u].fn,void 0,!0),d){case 1:h[u].fn.call(h[u].context);break;case 2:h[u].fn.call(h[u].context,t);break;case 3:h[u].fn.call(h[u].context,t,r);break;case 4:h[u].fn.call(h[u].context,t,r,a);break;default:if(!l)for(c=1,l=Array(d-1);c<d;c++)l[c-1]=arguments[c];h[u].fn.apply(h[u].context,l)}}return!0},o.prototype.on=function(e,t,i){return s(this,e,t,i,!1)},o.prototype.once=function(e,t,i){return s(this,e,t,i,!0)},o.prototype.removeListener=function(e,t,r,a){var s=i?i+e:e;if(!this._events[s])return this;if(!t)return n(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||a&&!o.once||r&&o.context!==r||n(this,s);else{for(var l=0,u=[],h=o.length;l<h;l++)(o[l].fn!==t||a&&!o[l].once||r&&o[l].context!==r)&&u.push(o[l]);u.length?this._events[s]=1===u.length?u[0]:u:n(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&n(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,e.exports=o},86958:function(e){"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},41163:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let r=i(77625),a=i(85179),s=i(40498),n=()=>{},o=new a.TimeoutError;class l extends r{constructor(e){var t,i,r,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=n,this._resolveIdle=n,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:s.default},e)).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(i=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==i?i:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(a=null===(r=e.interval)||void 0===r?void 0:r.toString())&&void 0!==a?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=n,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=n,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(void 0===this._intervalId){let t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((i,r)=>{let s=async()=>{this._pendingCount++,this._intervalCount++;try{let s=void 0===this._timeout&&void 0===t.timeout?e():a.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&r(o)});i(await s)}catch(e){r(e)}this._next()};this._queue.enqueue(s,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}t.default=l},97726:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,i){let r=0,a=e.length;for(;a>0;){let s=a/2|0,n=r+s;0>=i(e[n],t)?(r=++n,a-=s+1):a=s}return r}},40498:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let r=i(97726);class a{constructor(){this._queue=[]}enqueue(e,t){let i={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(i);return}let a=r.default(this._queue,i,(e,t)=>t.priority-e.priority);this._queue.splice(a,0,i)}dequeue(){let e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}t.default=a},82324:function(e,t,i){"use strict";let r=i(46220),a=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class s extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}let n=(e,t,i)=>{let r=i.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=r,e},o=e=>a.includes(e),l=(e,t)=>new Promise((i,a)=>{t={onFailedAttempt:()=>{},retries:10,...t};let l=r.operation(t);l.attempt(async r=>{try{i(await e(r))}catch(e){if(!(e instanceof Error)){a(TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));return}if(e instanceof s)l.stop(),a(e.originalError);else if(e instanceof TypeError&&!o(e.message))l.stop(),a(e);else{n(e,r,t);try{await t.onFailedAttempt(e)}catch(e){a(e);return}l.retry(e)||a(l.mainError())}}})});e.exports=l,e.exports.default=l,e.exports.AbortError=s},85179:function(e,t,i){"use strict";let r=i(86958);class a extends Error{constructor(e){super(e),this.name="TimeoutError"}}let s=(e,t,i)=>new Promise((s,n)=>{if("number"!=typeof t||t<0)throw TypeError("Expected `milliseconds` to be a positive number");if(t===1/0){s(e);return}let o=setTimeout(()=>{if("function"==typeof i){try{s(i())}catch(e){n(e)}return}let r="string"==typeof i?i:`Promise timed out after ${t} milliseconds`,o=i instanceof Error?i:new a(r);"function"==typeof e.cancel&&e.cancel(),n(o)},t);r(e.then(s,n),()=>{clearTimeout(o)})});e.exports=s,e.exports.default=s,e.exports.TimeoutError=a},46220:function(e,t,i){e.exports=i(94776)},94776:function(e,t,i){var r=i(95428);t.operation=function(e){return new r(t.timeouts(e),{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var i in e)t[i]=e[i];if(t.minTimeout>t.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var r=[],a=0;a<t.retries;a++)r.push(this.createTimeout(a,t));return e&&e.forever&&!r.length&&r.push(this.createTimeout(a,t)),r.sort(function(e,t){return e-t}),r},t.createTimeout=function(e,t){return Math.min(Math.round((t.randomize?Math.random()+1:1)*Math.max(t.minTimeout,1)*Math.pow(t.factor,e)),t.maxTimeout)},t.wrap=function(e,i,r){if(i instanceof Array&&(r=i,i=null),!r)for(var a in r=[],e)"function"==typeof e[a]&&r.push(a);for(var s=0;s<r.length;s++){var n=r[s],o=e[n];e[n]=(function(r){var a=t.operation(i),s=Array.prototype.slice.call(arguments,1),n=s.pop();s.push(function(e){a.retry(e)||(e&&(arguments[0]=a.mainError()),n.apply(this,arguments))}),a.attempt(function(){r.apply(e,s)})}).bind(e,o),e[n].options=i}}},95428:function(e){function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var i=this._timeouts.shift();if(void 0===i){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),i=this._cachedTimeouts.slice(-1)}var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},i),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var i=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){i._operationTimeoutCb()},i._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,i=0,r=0;r<this._errors.length;r++){var a=this._errors[r],s=a.message,n=(e[s]||0)+1;e[s]=n,n>=i&&(t=a,i=n)}return t}},98365:function(e,t,i){"use strict";let r=Symbol("SemVer ANY");class a{static get ANY(){return r}constructor(e,t){if(t=s(t),e instanceof a){if(!!t.loose===e.loose)return e;e=e.value}u("comparator",e=e.trim().split(/\s+/).join(" "),t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===r?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(e){let t=this.options.loose?n[o.COMPARATORLOOSE]:n[o.COMPARATOR],i=e.match(t);if(!i)throw TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==i[1]?i[1]:"","="===this.operator&&(this.operator=""),i[2]?this.semver=new h(i[2],this.options.loose):this.semver=r}toString(){return this.value}test(e){if(u("Comparator.test",e,this.options.loose),this.semver===r||e===r)return!0;if("string"==typeof e)try{e=new h(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof a))throw TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):!((t=s(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">"))}}e.exports=a;let s=i(56573),{safeRe:n,t:o}=i(61834),l=i(74526),u=i(37481),h=i(61269),d=i(96308)},96308:function(e,t,i){"use strict";let r=/\s+/g;class a{constructor(e,t){if(t=n(t),e instanceof a){if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;return new a(e.raw,t)}if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(r," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let e=this.set[0];if(this.set=this.set.filter(e=>!g(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1){for(let e of this.set)if(1===e.length&&b(e[0])){this.set=[e];break}}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let t=((this.options.includePrerelease&&f)|(this.options.loose&&_))+":"+e,i=s.get(t);if(i)return i;let r=this.options.loose,a=r?h[d.HYPHENRANGELOOSE]:h[d.HYPHENRANGE];l("hyphen replace",e=e.replace(a,N(this.options.includePrerelease))),l("comparator trim",e=e.replace(h[d.COMPARATORTRIM],c)),l("tilde trim",e=e.replace(h[d.TILDETRIM],p)),l("caret trim",e=e.replace(h[d.CARETTRIM],m));let n=e.split(" ").map(e=>v(e,this.options)).join(" ").split(/\s+/).map(e=>R(e,this.options));r&&(n=n.filter(e=>(l("loose invalid filter",e,this.options),!!e.match(h[d.COMPARATORLOOSE])))),l("range list",n);let u=new Map;for(let e of n.map(e=>new o(e,this.options))){if(g(e))return[e];u.set(e.value,e)}u.size>1&&u.has("")&&u.delete("");let b=[...u.values()];return s.set(t,b),b}intersects(e,t){if(!(e instanceof a))throw TypeError("a Range is required");return this.set.some(i=>y(i,t)&&e.set.some(e=>y(e,t)&&i.every(i=>e.every(e=>i.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(P(this.set[t],e,this.options))return!0;return!1}}e.exports=a;let s=new(i(88911)),n=i(56573),o=i(98365),l=i(37481),u=i(61269),{safeRe:h,t:d,comparatorTrimReplace:c,tildeTrimReplace:p,caretTrimReplace:m}=i(61834),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:_}=i(52310),g=e=>"<0.0.0-0"===e.value,b=e=>""===e.value,y=(e,t)=>{let i=!0,r=e.slice(),a=r.pop();for(;i&&r.length;)i=r.every(e=>a.intersects(e,t)),a=r.pop();return i},v=(e,t)=>(l("comp",e,t),l("caret",e=I(e,t)),l("tildes",e=E(e,t)),l("xrange",e=O(e,t)),l("stars",e=A(e,t)),e),w=e=>!e||"x"===e.toLowerCase()||"*"===e,E=(e,t)=>e.trim().split(/\s+/).map(e=>$(e,t)).join(" "),$=(e,t)=>{let i=t.loose?h[d.TILDELOOSE]:h[d.TILDE];return e.replace(i,(t,i,r,a,s)=>{let n;return l("tilde",e,t,i,r,a,s),w(i)?n="":w(r)?n=`>=${i}.0.0 <${+i+1}.0.0-0`:w(a)?n=`>=${i}.${r}.0 <${i}.${+r+1}.0-0`:s?(l("replaceTilde pr",s),n=`>=${i}.${r}.${a}-${s} <${i}.${+r+1}.0-0`):n=`>=${i}.${r}.${a} <${i}.${+r+1}.0-0`,l("tilde return",n),n})},I=(e,t)=>e.trim().split(/\s+/).map(e=>S(e,t)).join(" "),S=(e,t)=>{l("caret",e,t);let i=t.loose?h[d.CARETLOOSE]:h[d.CARET],r=t.includePrerelease?"-0":"";return e.replace(i,(t,i,a,s,n)=>{let o;return l("caret",e,t,i,a,s,n),w(i)?o="":w(a)?o=`>=${i}.0.0${r} <${+i+1}.0.0-0`:w(s)?o="0"===i?`>=${i}.${a}.0${r} <${i}.${+a+1}.0-0`:`>=${i}.${a}.0${r} <${+i+1}.0.0-0`:n?(l("replaceCaret pr",n),o="0"===i?"0"===a?`>=${i}.${a}.${s}-${n} <${i}.${a}.${+s+1}-0`:`>=${i}.${a}.${s}-${n} <${i}.${+a+1}.0-0`:`>=${i}.${a}.${s}-${n} <${+i+1}.0.0-0`):(l("no pr"),o="0"===i?"0"===a?`>=${i}.${a}.${s}${r} <${i}.${a}.${+s+1}-0`:`>=${i}.${a}.${s}${r} <${i}.${+a+1}.0-0`:`>=${i}.${a}.${s} <${+i+1}.0.0-0`),l("caret return",o),o})},O=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map(e=>T(e,t)).join(" ")),T=(e,t)=>{e=e.trim();let i=t.loose?h[d.XRANGELOOSE]:h[d.XRANGE];return e.replace(i,(i,r,a,s,n,o)=>{l("xRange",e,i,r,a,s,n,o);let u=w(a),h=u||w(s),d=h||w(n);return"="===r&&d&&(r=""),o=t.includePrerelease?"-0":"",u?i=">"===r||"<"===r?"<0.0.0-0":"*":r&&d?(h&&(s=0),n=0,">"===r?(r=">=",h?(a=+a+1,s=0):s=+s+1,n=0):"<="===r&&(r="<",h?a=+a+1:s=+s+1),"<"===r&&(o="-0"),i=`${r+a}.${s}.${n}${o}`):h?i=`>=${a}.0.0${o} <${+a+1}.0.0-0`:d&&(i=`>=${a}.${s}.0${o} <${a}.${+s+1}.0-0`),l("xRange return",i),i})},A=(e,t)=>(l("replaceStars",e,t),e.trim().replace(h[d.STAR],"")),R=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(h[t.includePrerelease?d.GTE0PRE:d.GTE0],"")),N=e=>(t,i,r,a,s,n,o,l,u,h,d,c)=>(i=w(r)?"":w(a)?`>=${r}.0.0${e?"-0":""}`:w(s)?`>=${r}.${a}.0${e?"-0":""}`:n?`>=${i}`:`>=${i}${e?"-0":""}`,l=w(u)?"":w(h)?`<${+u+1}.0.0-0`:w(d)?`<${u}.${+h+1}.0-0`:c?`<=${u}.${h}.${d}-${c}`:e?`<${u}.${h}.${+d+1}-0`:`<=${l}`,`${i} ${l}`.trim()),P=(e,t,i)=>{for(let i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(t.prerelease.length&&!i.includePrerelease){for(let i=0;i<e.length;i++)if(l(e[i].semver),e[i].semver!==o.ANY&&e[i].semver.prerelease.length>0){let r=e[i].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0}},61269:function(e,t,i){"use strict";let r=i(37481),{MAX_LENGTH:a,MAX_SAFE_INTEGER:s}=i(52310),{safeRe:n,t:o}=i(61834),l=i(56573),{compareIdentifiers:u}=i(13751);class h{constructor(e,t){if(t=l(t),e instanceof h){if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>a)throw TypeError(`version is longer than ${a} characters`);r("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let i=e.trim().match(t.loose?n[o.LOOSE]:n[o.FULL]);if(!i)throw TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>s||this.major<0)throw TypeError("Invalid major version");if(this.minor>s||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>s||this.patch<0)throw TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){let t=+e;if(t>=0&&t<s)return t}return e}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(r("SemVer.compare",this.version,this.options,e),!(e instanceof h)){if("string"==typeof e&&e===this.version)return 0;e=new h(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof h||(e=new h(e,this.options)),u(this.major,e.major)||u(this.minor,e.minor)||u(this.patch,e.patch)}comparePre(e){if(e instanceof h||(e=new h(e,this.options)),this.prerelease.length&&!e.prerelease.length)return -1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let i=this.prerelease[t],a=e.prerelease[t];if(r("prerelease compare",t,i,a),void 0===i&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===i)return -1;if(i===a)continue;else return u(i,a)}while(++t)}compareBuild(e){e instanceof h||(e=new h(e,this.options));let t=0;do{let i=this.build[t],a=e.build[t];if(r("build compare",t,i,a),void 0===i&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===i)return -1;if(i===a)continue;else return u(i,a)}while(++t)}inc(e,t,i){if(e.startsWith("pre")){if(!t&&!1===i)throw Error("invalid increment argument: identifier is empty");if(t){let e=`-${t}`.match(this.options.loose?n[o.PRERELEASELOOSE]:n[o.PRERELEASE]);if(!e||e[1]!==t)throw Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,i);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,i);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,i),this.inc("pre",t,i);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,i),this.inc("pre",t,i);break;case"release":if(0===this.prerelease.length)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{let e=Number(i)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let r=this.prerelease.length;for(;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);if(-1===r){if(t===this.prerelease.join(".")&&!1===i)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let r=[t,e];!1===i&&(r=[t]),0===u(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=r):this.prerelease=r}break}default:throw Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=h},74423:function(e,t,i){"use strict";let r=i(86472);e.exports=(e,t)=>{let i=r(e.trim().replace(/^[=v]+/,""),t);return i?i.version:null}},74526:function(e,t,i){"use strict";let r=i(84429),a=i(54084),s=i(91877),n=i(54159),o=i(1749),l=i(74063);e.exports=(e,t,i,u)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof i&&(i=i.version),e===i;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof i&&(i=i.version),e!==i;case"":case"=":case"==":return r(e,i,u);case"!=":return a(e,i,u);case">":return s(e,i,u);case">=":return n(e,i,u);case"<":return o(e,i,u);case"<=":return l(e,i,u);default:throw TypeError(`Invalid operator: ${t}`)}}},6028:function(e,t,i){"use strict";let r=i(61269),a=i(86472),{safeRe:s,t:n}=i(61834);e.exports=(e,t)=>{if(e instanceof r)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let i=null;if((t=t||{}).rtl){let r;let a=t.includePrerelease?s[n.COERCERTLFULL]:s[n.COERCERTL];for(;(r=a.exec(e))&&(!i||i.index+i[0].length!==e.length);)i&&r.index+r[0].length===i.index+i[0].length||(i=r),a.lastIndex=r.index+r[1].length+r[2].length;a.lastIndex=-1}else i=e.match(t.includePrerelease?s[n.COERCEFULL]:s[n.COERCE]);if(null===i)return null;let o=i[2],l=i[3]||"0",u=i[4]||"0",h=t.includePrerelease&&i[5]?`-${i[5]}`:"",d=t.includePrerelease&&i[6]?`+${i[6]}`:"";return a(`${o}.${l}.${u}${h}${d}`,t)}},17337:function(e,t,i){"use strict";let r=i(61269);e.exports=(e,t,i)=>{let a=new r(e,i),s=new r(t,i);return a.compare(s)||a.compareBuild(s)}},78754:function(e,t,i){"use strict";let r=i(75625);e.exports=(e,t)=>r(e,t,!0)},75625:function(e,t,i){"use strict";let r=i(61269);e.exports=(e,t,i)=>new r(e,i).compare(new r(t,i))},42921:function(e,t,i){"use strict";let r=i(86472);e.exports=(e,t)=>{let i=r(e,null,!0),a=r(t,null,!0),s=i.compare(a);if(0===s)return null;let n=s>0,o=n?i:a,l=n?a:i,u=!!o.prerelease.length;if(l.prerelease.length&&!u){if(!l.patch&&!l.minor)return"major";if(0===l.compareMain(o))return l.minor&&!l.patch?"minor":"patch"}let h=u?"pre":"";return i.major!==a.major?h+"major":i.minor!==a.minor?h+"minor":i.patch!==a.patch?h+"patch":"prerelease"}},84429:function(e,t,i){"use strict";let r=i(75625);e.exports=(e,t,i)=>0===r(e,t,i)},91877:function(e,t,i){"use strict";let r=i(75625);e.exports=(e,t,i)=>r(e,t,i)>0},54159:function(e,t,i){"use strict";let r=i(75625);e.exports=(e,t,i)=>r(e,t,i)>=0},60827:function(e,t,i){"use strict";let r=i(61269);e.exports=(e,t,i,a,s)=>{"string"==typeof i&&(s=a,a=i,i=void 0);try{return new r(e instanceof r?e.version:e,i).inc(t,a,s).version}catch(e){return null}}},1749:function(e,t,i){"use strict";let r=i(75625);e.exports=(e,t,i)=>0>r(e,t,i)},74063:function(e,t,i){"use strict";let r=i(75625);e.exports=(e,t,i)=>0>=r(e,t,i)},87176:function(e,t,i){"use strict";let r=i(61269);e.exports=(e,t)=>new r(e,t).major},38161:function(e,t,i){"use strict";let r=i(61269);e.exports=(e,t)=>new r(e,t).minor},54084:function(e,t,i){"use strict";let r=i(75625);e.exports=(e,t,i)=>0!==r(e,t,i)},86472:function(e,t,i){"use strict";let r=i(61269);e.exports=(e,t,i=!1)=>{if(e instanceof r)return e;try{return new r(e,t)}catch(e){if(!i)return null;throw e}}},35516:function(e,t,i){"use strict";let r=i(61269);e.exports=(e,t)=>new r(e,t).patch},95936:function(e,t,i){"use strict";let r=i(86472);e.exports=(e,t)=>{let i=r(e,t);return i&&i.prerelease.length?i.prerelease:null}},723:function(e,t,i){"use strict";let r=i(75625);e.exports=(e,t,i)=>r(t,e,i)},27415:function(e,t,i){"use strict";let r=i(17337);e.exports=(e,t)=>e.sort((e,i)=>r(i,e,t))},60875:function(e,t,i){"use strict";let r=i(96308);e.exports=(e,t,i)=>{try{t=new r(t,i)}catch(e){return!1}return t.test(e)}},63535:function(e,t,i){"use strict";let r=i(17337);e.exports=(e,t)=>e.sort((e,i)=>r(e,i,t))},24121:function(e,t,i){"use strict";let r=i(86472);e.exports=(e,t)=>{let i=r(e,t);return i?i.version:null}},67374:function(e,t,i){"use strict";let r=i(61834),a=i(52310),s=i(61269),n=i(13751),o=i(86472),l=i(24121),u=i(74423),h=i(60827),d=i(42921),c=i(87176),p=i(38161),m=i(35516),f=i(95936),_=i(75625),g=i(723),b=i(78754),y=i(17337),v=i(63535),w=i(27415),E=i(91877),$=i(1749),I=i(84429),S=i(54084),O=i(54159),T=i(74063),A=i(74526),R=i(6028),N=i(98365),P=i(96308),j=i(60875),x=i(72705),C=i(96018),L=i(75899),U=i(36977),k=i(93274),D=i(55040),M=i(96953),G=i(18123),F=i(61679),B=i(72298),H=i(67411);e.exports={parse:o,valid:l,clean:u,inc:h,diff:d,major:c,minor:p,patch:m,prerelease:f,compare:_,rcompare:g,compareLoose:b,compareBuild:y,sort:v,rsort:w,gt:E,lt:$,eq:I,neq:S,gte:O,lte:T,cmp:A,coerce:R,Comparator:N,Range:P,satisfies:j,toComparators:x,maxSatisfying:C,minSatisfying:L,minVersion:U,validRange:k,outside:D,gtr:M,ltr:G,intersects:F,simplifyRange:B,subset:H,SemVer:s,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:a.SEMVER_SPEC_VERSION,RELEASE_TYPES:a.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers}},52310:function(e){"use strict";let t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},37481:function(e,t,i){"use strict";var r=i(40257);let a="object"==typeof r&&r.env&&r.env.NODE_DEBUG&&/\bsemver\b/i.test(r.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=a},13751:function(e){"use strict";let t=/^[0-9]+$/,i=(e,i)=>{let r=t.test(e),a=t.test(i);return r&&a&&(e=+e,i=+i),e===i?0:r&&!a?-1:a&&!r?1:e<i?-1:1};e.exports={compareIdentifiers:i,rcompareIdentifiers:(e,t)=>i(t,e)}},88911:function(e){"use strict";class t{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(void 0!==t)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){let e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}e.exports=t},56573:function(e){"use strict";let t=Object.freeze({loose:!0}),i=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:i},61834:function(e,t,i){"use strict";let{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:a,MAX_LENGTH:s}=i(52310),n=i(37481),o=(t=e.exports={}).re=[],l=t.safeRe=[],u=t.src=[],h=t.safeSrc=[],d=t.t={},c=0,p="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",s],[p,a]],f=e=>{for(let[t,i]of m)e=e.split(`${t}*`).join(`${t}{0,${i}}`).split(`${t}+`).join(`${t}{1,${i}}`);return e},_=(e,t,i)=>{let r=f(t),a=c++;n(e,a,t),d[e]=a,u[a]=t,h[a]=r,o[a]=new RegExp(t,i?"g":void 0),l[a]=new RegExp(r,i?"g":void 0)};_("NUMERICIDENTIFIER","0|[1-9]\\d*"),_("NUMERICIDENTIFIERLOOSE","\\d+"),_("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),_("MAINVERSION",`(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})`),_("MAINVERSIONLOOSE",`(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})`),_("PRERELEASEIDENTIFIER",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIER]})`),_("PRERELEASEIDENTIFIERLOOSE",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIERLOOSE]})`),_("PRERELEASE",`(?:-(${u[d.PRERELEASEIDENTIFIER]}(?:\\.${u[d.PRERELEASEIDENTIFIER]})*))`),_("PRERELEASELOOSE",`(?:-?(${u[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[d.PRERELEASEIDENTIFIERLOOSE]})*))`),_("BUILDIDENTIFIER",`${p}+`),_("BUILD",`(?:\\+(${u[d.BUILDIDENTIFIER]}(?:\\.${u[d.BUILDIDENTIFIER]})*))`),_("FULLPLAIN",`v?${u[d.MAINVERSION]}${u[d.PRERELEASE]}?${u[d.BUILD]}?`),_("FULL",`^${u[d.FULLPLAIN]}$`),_("LOOSEPLAIN",`[v=\\s]*${u[d.MAINVERSIONLOOSE]}${u[d.PRERELEASELOOSE]}?${u[d.BUILD]}?`),_("LOOSE",`^${u[d.LOOSEPLAIN]}$`),_("GTLT","((?:<|>)?=?)"),_("XRANGEIDENTIFIERLOOSE",`${u[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),_("XRANGEIDENTIFIER",`${u[d.NUMERICIDENTIFIER]}|x|X|\\*`),_("XRANGEPLAIN",`[v=\\s]*(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:${u[d.PRERELEASE]})?${u[d.BUILD]}?)?)?`),_("XRANGEPLAINLOOSE",`[v=\\s]*(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:${u[d.PRERELEASELOOSE]})?${u[d.BUILD]}?)?)?`),_("XRANGE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAIN]}$`),_("XRANGELOOSE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAINLOOSE]}$`),_("COERCEPLAIN",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?`),_("COERCE",`${u[d.COERCEPLAIN]}(?:$|[^\\d])`),_("COERCEFULL",u[d.COERCEPLAIN]+`(?:${u[d.PRERELEASE]})?`+`(?:${u[d.BUILD]})?`+"(?:$|[^\\d])"),_("COERCERTL",u[d.COERCE],!0),_("COERCERTLFULL",u[d.COERCEFULL],!0),_("LONETILDE","(?:~>?)"),_("TILDETRIM",`(\\s*)${u[d.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",_("TILDE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAIN]}$`),_("TILDELOOSE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAINLOOSE]}$`),_("LONECARET","(?:\\^)"),_("CARETTRIM",`(\\s*)${u[d.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",_("CARET",`^${u[d.LONECARET]}${u[d.XRANGEPLAIN]}$`),_("CARETLOOSE",`^${u[d.LONECARET]}${u[d.XRANGEPLAINLOOSE]}$`),_("COMPARATORLOOSE",`^${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]})$|^$`),_("COMPARATOR",`^${u[d.GTLT]}\\s*(${u[d.FULLPLAIN]})$|^$`),_("COMPARATORTRIM",`(\\s*)${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]}|${u[d.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",_("HYPHENRANGE",`^\\s*(${u[d.XRANGEPLAIN]})\\s+-\\s+(${u[d.XRANGEPLAIN]})\\s*$`),_("HYPHENRANGELOOSE",`^\\s*(${u[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[d.XRANGEPLAINLOOSE]})\\s*$`),_("STAR","(<|>)?=?\\s*\\*"),_("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),_("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},96953:function(e,t,i){"use strict";let r=i(55040);e.exports=(e,t,i)=>r(e,t,">",i)},61679:function(e,t,i){"use strict";let r=i(96308);e.exports=(e,t,i)=>(e=new r(e,i),t=new r(t,i),e.intersects(t,i))},18123:function(e,t,i){"use strict";let r=i(55040);e.exports=(e,t,i)=>r(e,t,"<",i)},96018:function(e,t,i){"use strict";let r=i(61269),a=i(96308);e.exports=(e,t,i)=>{let s=null,n=null,o=null;try{o=new a(t,i)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!s||-1===n.compare(e))&&(n=new r(s=e,i))}),s}},75899:function(e,t,i){"use strict";let r=i(61269),a=i(96308);e.exports=(e,t,i)=>{let s=null,n=null,o=null;try{o=new a(t,i)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!s||1===n.compare(e))&&(n=new r(s=e,i))}),s}},36977:function(e,t,i){"use strict";let r=i(61269),a=i(96308),s=i(91877);e.exports=(e,t)=>{e=new a(e,t);let i=new r("0.0.0");if(e.test(i)||(i=new r("0.0.0-0"),e.test(i)))return i;i=null;for(let t=0;t<e.set.length;++t){let a=e.set[t],n=null;a.forEach(e=>{let t=new r(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":(!n||s(t,n))&&(n=t);break;case"<":case"<=":break;default:throw Error(`Unexpected operation: ${e.operator}`)}}),n&&(!i||s(i,n))&&(i=n)}return i&&e.test(i)?i:null}},55040:function(e,t,i){"use strict";let r=i(61269),a=i(98365),{ANY:s}=a,n=i(96308),o=i(60875),l=i(91877),u=i(1749),h=i(74063),d=i(54159);e.exports=(e,t,i,c)=>{let p,m,f,_,g;switch(e=new r(e,c),t=new n(t,c),i){case">":p=l,m=h,f=u,_=">",g=">=";break;case"<":p=u,m=d,f=l,_="<",g="<=";break;default:throw TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,c))return!1;for(let i=0;i<t.set.length;++i){let r=t.set[i],n=null,o=null;if(r.forEach(e=>{e.semver===s&&(e=new a(">=0.0.0")),n=n||e,o=o||e,p(e.semver,n.semver,c)?n=e:f(e.semver,o.semver,c)&&(o=e)}),n.operator===_||n.operator===g||(!o.operator||o.operator===_)&&m(e,o.semver)||o.operator===g&&f(e,o.semver))return!1}return!0}},72298:function(e,t,i){"use strict";let r=i(60875),a=i(75625);e.exports=(e,t,i)=>{let s=[],n=null,o=null,l=e.sort((e,t)=>a(e,t,i));for(let e of l)r(e,t,i)?(o=e,n||(n=e)):(o&&s.push([n,o]),o=null,n=null);n&&s.push([n,null]);let u=[];for(let[e,t]of s)e===t?u.push(e):t||e!==l[0]?t?e===l[0]?u.push(`<=${t}`):u.push(`${e} - ${t}`):u.push(`>=${e}`):u.push("*");let h=u.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return h.length<d.length?h:t}},67411:function(e,t,i){"use strict";let r=i(96308),a=i(98365),{ANY:s}=a,n=i(60875),o=i(75625),l=[new a(">=0.0.0-0")],u=[new a(">=0.0.0")],h=(e,t,i)=>{let r,a,h,p,m,f,_;if(e===t)return!0;if(1===e.length&&e[0].semver===s){if(1===t.length&&t[0].semver===s)return!0;e=i.includePrerelease?l:u}if(1===t.length&&t[0].semver===s){if(i.includePrerelease)return!0;t=u}let g=new Set;for(let t of e)">"===t.operator||">="===t.operator?r=d(r,t,i):"<"===t.operator||"<="===t.operator?a=c(a,t,i):g.add(t.semver);if(g.size>1||r&&a&&((h=o(r.semver,a.semver,i))>0||0===h&&(">="!==r.operator||"<="!==a.operator)))return null;for(let e of g){if(r&&!n(e,String(r),i)||a&&!n(e,String(a),i))return null;for(let r of t)if(!n(e,String(r),i))return!1;return!0}let b=!!a&&!i.includePrerelease&&!!a.semver.prerelease.length&&a.semver,y=!!r&&!i.includePrerelease&&!!r.semver.prerelease.length&&r.semver;for(let e of(b&&1===b.prerelease.length&&"<"===a.operator&&0===b.prerelease[0]&&(b=!1),t)){if(_=_||">"===e.operator||">="===e.operator,f=f||"<"===e.operator||"<="===e.operator,r){if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),">"===e.operator||">="===e.operator){if((p=d(r,e,i))===e&&p!==r)return!1}else if(">="===r.operator&&!n(r.semver,String(e),i))return!1}if(a){if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),"<"===e.operator||"<="===e.operator){if((m=c(a,e,i))===e&&m!==a)return!1}else if("<="===a.operator&&!n(a.semver,String(e),i))return!1}if(!e.operator&&(a||r)&&0!==h)return!1}return(!r||!f||!!a||0===h)&&(!a||!_||!!r||0===h)&&!y&&!b},d=(e,t,i)=>{if(!e)return t;let r=o(e.semver,t.semver,i);return r>0?e:r<0?t:">"===t.operator&&">="===e.operator?t:e},c=(e,t,i)=>{if(!e)return t;let r=o(e.semver,t.semver,i);return r<0?e:r>0?t:"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,i={})=>{if(e===t)return!0;e=new r(e,i),t=new r(t,i);let a=!1;e:for(let r of e.set){for(let e of t.set){let t=h(r,e,i);if(a=a||null!==t,t)continue e}if(a)return!1}return!0}},72705:function(e,t,i){"use strict";let r=i(96308);e.exports=(e,t)=>new r(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},93274:function(e,t,i){"use strict";let r=i(96308);e.exports=(e,t)=>{try{return new r(e,t).range||"*"}catch(e){return null}}},81505:function(e,t,i){"use strict";let r,a,s;i.r(t),i.d(t,{Client:function(){return eO},RunTree:function(){return eU},__version__:function(){return eM},getDefaultProjectName:function(){return eC},overrideFetchImplementation:function(){return J}});for(var n,o={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},l=new Uint8Array(16),u=[],h=0;h<256;++h)u.push((h+256).toString(16).slice(1));function d(e,t=0){return(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase()}var c=function(e,t,i){if(o.randomUUID&&!t&&!e)return o.randomUUID();var r=(e=e||{}).random||(e.rng||function(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(l)})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){i=i||0;for(var a=0;a<16;++a)t[i+a]=r[a];return t}return d(r)};let p="gen_ai.request.model",m="gen_ai.usage.input_tokens",f="gen_ai.usage.output_tokens",_="gen_ai.usage.total_tokens",g="langsmith.span.tags";var b=i(40257);let y=()=>"undefined"!=typeof window&&void 0!==window.document,v=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,w=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom"),E=()=>"undefined"!=typeof Deno,$=()=>void 0!==b&&void 0!==b.versions&&void 0!==b.versions.node&&!E(),I=()=>r||(r=y()?"browser":$()?"node":v()?"webworker":w()?"jsdom":E()?"deno":"other");function S(){return void 0===a&&(a={library:"langsmith",runtime:I(),sdk:"langsmith-js",sdk_version:eM,...function(){if(void 0!==s)return s;let e={};for(let t of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let i=O(t);void 0!==i&&(e[t]=i)}return s=e,e}()}),a}function O(e){try{return void 0!==b?b.env?.[e]:void 0}catch(e){return}}function T(e){return O(`LANGSMITH_${e}`)||O(`LANGCHAIN_${e}`)}function A(){return"true"===O("OTEL_ENABLED")||"true"===T("OTEL_ENABLED")}class R{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){let i;if(!this.hasWarned&&A()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0),1===t.length&&"function"==typeof t[0]?i=t[0]:2===t.length&&"function"==typeof t[1]?i=t[1]:3===t.length&&"function"==typeof t[2]&&(i=t[2]),"function"==typeof i)return i()}}class N{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new R})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}}class P{active(){return{}}with(e,t){return t()}}let j=Symbol.for("ls:otel_trace"),x=Symbol.for("ls:otel_context"),C=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),L=new N,U=new P;class k{getTraceInstance(){return globalThis[j]??L}getContextInstance(){return globalThis[x]??U}initializeGlobalInstances(e){void 0===globalThis[j]&&(globalThis[j]=e.trace),void 0===globalThis[x]&&(globalThis[x]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[C]=e}getDefaultOTLPTracerComponents(){return globalThis[C]??void 0}}let D=new k;function M(){return D.getTraceInstance()}let G={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};class F{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(let i of e)try{if(!i.run)continue;if("post"===i.operation){let e=this.createSpanForRun(i,i.run,t.get(i.id));e&&!i.run.end_time&&this.spans.set(i.id,e)}else this.updateSpanForRun(i,i.run)}catch(e){console.error(`Error processing operation ${i.id}:`,e)}}createSpanForRun(e,t,i){let r=i&&M().getSpan(i);if(r)try{return this.finishSpanSetup(r,t,e)}catch(t){console.error(`Failed to create span for run ${e.id}:`,t);return}}finishSpanSetup(e,t,i){return this.setSpanAttributes(e,t,i),t.error?(e.setStatus({code:2}),e.recordException(Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{let i=this.spans.get(e.id);if(!i){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(i,t,e),t.error?(i.setStatus({code:2}),i.recordException(Error(t.error))):i.setStatus({code:1});let r=t.end_time;r&&(i.end(new Date(r)),this.spans.delete(e.id))}catch(t){console.error(`Failed to update span for run ${e.id}:`,t)}}extractModelName(e){if(e.extra?.metadata){let t=e.extra.metadata;if(t.ls_model_name)return t.ls_model_name;if(t.invocation_params){let e=t.invocation_params;if(e.model)return e.model;if(e.model_name)return e.model_name}}}setSpanAttributes(e,t,i){if("run_type"in t&&t.run_type){var r;e.setAttribute("langsmith.span.kind",t.run_type);let i=G[r=t.run_type||"chain"]||r;e.setAttribute("gen_ai.operation.name",i)}"name"in t&&t.name&&e.setAttribute("langsmith.trace.name",t.name),"session_id"in t&&t.session_id&&e.setAttribute("langsmith.trace.session_id",t.session_id),"session_name"in t&&t.session_name&&e.setAttribute("langsmith.trace.session_name",t.session_name),this.setGenAiSystem(e,t);let a=this.extractModelName(t);for(let[i,r]of(a&&e.setAttribute(p,a),"prompt_tokens"in t&&"number"==typeof t.prompt_tokens&&e.setAttribute(m,t.prompt_tokens),"completion_tokens"in t&&"number"==typeof t.completion_tokens&&e.setAttribute(f,t.completion_tokens),"total_tokens"in t&&"number"==typeof t.total_tokens&&e.setAttribute(_,t.total_tokens),this.setInvocationParameters(e,t),Object.entries(t.extra?.metadata||{})))null!=r&&e.setAttribute(`langsmith.metadata.${i}`,String(r));let s=t.tags;if(s&&Array.isArray(s)?e.setAttribute(g,s.join(", ")):s&&e.setAttribute(g,String(s)),"serialized"in t&&"object"==typeof t.serialized){let i=t.serialized;i.name&&e.setAttribute("gen_ai.serialized.name",String(i.name)),i.signature&&e.setAttribute("gen_ai.serialized.signature",String(i.signature)),i.doc&&e.setAttribute("gen_ai.serialized.doc",String(i.doc))}this.setIOAttributes(e,i)}setGenAiSystem(e,t){let i="langchain",r=this.extractModelName(t);if(r){let e=r.toLowerCase();e.includes("anthropic")||e.startsWith("claude")?i="anthropic":e.includes("bedrock")?i="aws.bedrock":e.includes("azure")&&e.includes("openai")?i="az.ai.openai":e.includes("azure")&&e.includes("inference")?i="az.ai.inference":e.includes("cohere")?i="cohere":e.includes("deepseek")?i="deepseek":e.includes("gemini")?i="gemini":e.includes("groq")?i="groq":e.includes("watson")||e.includes("ibm")?i="ibm.watsonx.ai":e.includes("mistral")?i="mistral_ai":e.includes("gpt")||e.includes("openai")?i="openai":e.includes("perplexity")||e.includes("sonar")?i="perplexity":e.includes("vertex")?i="vertex_ai":(e.includes("xai")||e.includes("grok"))&&(i="xai")}e.setAttribute("gen_ai.system",i)}setInvocationParameters(e,t){if(!t.extra?.metadata?.invocation_params)return;let i=t.extra.metadata.invocation_params;void 0!==i.max_tokens&&e.setAttribute("gen_ai.request.max_tokens",i.max_tokens),void 0!==i.temperature&&e.setAttribute("gen_ai.request.temperature",i.temperature),void 0!==i.top_p&&e.setAttribute("gen_ai.request.top_p",i.top_p),void 0!==i.frequency_penalty&&e.setAttribute("gen_ai.request.frequency_penalty",i.frequency_penalty),void 0!==i.presence_penalty&&e.setAttribute("gen_ai.request.presence_penalty",i.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{let i=t.run.inputs;"object"==typeof i&&null!==i&&(i.model&&Array.isArray(i.messages)&&e.setAttribute(p,i.model),void 0!==i.stream&&e.setAttribute("langsmith.request.streaming",i.stream),i.extra_headers&&e.setAttribute("langsmith.request.headers",JSON.stringify(i.extra_headers)),i.extra_query&&e.setAttribute("gen_ai.request.extra_query",JSON.stringify(i.extra_query)),i.extra_body&&e.setAttribute("gen_ai.request.extra_body",JSON.stringify(i.extra_body))),e.setAttribute("gen_ai.prompt",JSON.stringify(i))}catch(e){console.debug(`Failed to process inputs for run ${t.id}`,e)}if(t.run.outputs)try{let i=t.run.outputs,r=this.getUnifiedRunTokens(i);if(r&&(e.setAttribute(m,r[0]),e.setAttribute(f,r[1]),e.setAttribute(_,r[0]+r[1])),i&&"object"==typeof i){if(i.model&&e.setAttribute("gen_ai.response.model",String(i.model)),i.id&&e.setAttribute("gen_ai.response.id",i.id),i.choices&&Array.isArray(i.choices)){let t=i.choices.map(e=>e.finish_reason).filter(e=>e).map(String);t.length>0&&e.setAttribute("gen_ai.response.finish_reasons",t.join(", "))}if(i.service_tier&&e.setAttribute("gen_ai.response.service_tier",i.service_tier),i.system_fingerprint&&e.setAttribute("gen_ai.response.system_fingerprint",i.system_fingerprint),i.usage_metadata&&"object"==typeof i.usage_metadata){let t=i.usage_metadata;t.input_token_details&&e.setAttribute("gen_ai.usage.input_token_details",JSON.stringify(t.input_token_details)),t.output_token_details&&e.setAttribute("gen_ai.usage.output_token_details",JSON.stringify(t.output_token_details))}}e.setAttribute("gen_ai.completion",JSON.stringify(i))}catch(e){console.debug(`Failed to process outputs for run ${t.id}`,e)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;for(let i of Object.keys(e)){let r=e[i];if(r&&"object"==typeof r&&((t=this.extractUnifiedRunTokens(r.usage_metadata))||1===r.lc&&r.kwargs&&"object"==typeof r.kwargs&&(t=this.extractUnifiedRunTokens(r.kwargs.usage_metadata))))return t}let i=e.generations||[];if(!Array.isArray(i))return null;for(let e of Array.isArray(i[0])?i.flat():i)if("object"==typeof e&&e.message&&"object"==typeof e.message&&e.message.kwargs&&"object"==typeof e.message.kwargs&&(t=this.extractUnifiedRunTokens(e.message.kwargs.usage_metadata)))return t;return null}extractUnifiedRunTokens(e){return e&&"object"==typeof e&&"number"==typeof e.input_tokens&&"number"==typeof e.output_tokens?[e.input_tokens,e.output_tokens]:null}}var B=i(82324),H=i(41163);let q=(...e)=>fetch(...e),z=Symbol.for("ls:fetch_implementation"),J=e=>{globalThis[z]=e},K=()=>{let e=globalThis[z];return!!e&&"function"==typeof e&&"Headers"in e&&"Request"in e&&"Response"in e},W=e=>async(...t)=>{if(e||"true"===T("DEBUG")){let[e,i]=t;console.log(`→ ${i?.method||"GET"} ${e}`)}let i=await (globalThis[z]??q)(...t);return(e||"true"===T("DEBUG"))&&console.log(`← ${i.status} ${i.statusText} ${i.url}`),i},X=[400,401,403,404,405,406,407,408],V=[409];class Q{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.debug=e.debug,this.queue=new H.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let i=this.onFailedResponseHook;return this.queue.add(()=>B(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{async onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError")||e?.code==="ECONNABORTED")throw e;let t=e?.response,r=t?.status;if(r){if(X.includes(+r))throw e;if(V.includes(+r))return;i&&await i(t)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...i){return e.signal?Promise.race([this.call(t,...i),new Promise((t,i)=>{e.signal?.addEventListener("abort",()=>{i(Error("AbortError"))})})]):this.call(t,...i)}fetch(...e){return this.call(()=>W(this.debug)(...e).then(e=>e.ok?e:Promise.reject(e)))}}function Y(e){return"function"==typeof e?._getType}function Z(e){let t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}let ee=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function et(e,t){if(!ee.test(e))throw Error(void 0!==t?`Invalid UUID for ${t}: ${e}`:`Invalid UUID: ${e}`);return e}let ei={};function er(e){ei[e]||(console.warn(e),ei[e]=!0)}function ea(e){if(!e||e.split("/").length>2||e.startsWith("/")||e.endsWith("/")||e.split(":").length>2)throw Error(`Invalid identifier format: ${e}`);let[t,i]=e.split(":"),r=i||"latest";if(t.includes("/")){let[i,a]=t.split("/",2);if(!i||!a)throw Error(`Invalid identifier format: ${e}`);return[i,a,r]}if(!t)throw Error(`Invalid identifier format: ${e}`);return["-",t,r]}i(67374);class es extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function en(e,t,i){let r;if(e.ok){i&&(r=await e.text());return}r=await e.text();let a=`Failed to ${t}. Received status [${e.status}]: ${e.statusText}. Server response: ${r}`;if(409===e.status)throw new es(a);let s=Error(a);throw s.status=e.status,s}let eo="ERR_CONFLICTING_ENDPOINTS";class el extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:eo}),this.name="ConflictingEndpointsError"}}var eu={result:"[Circular]"},eh=[],ed=[];let ec=new TextEncoder;function ep(e){return ec.encode(e)}function em(e){if(e&&"object"==typeof e&&null!==e){if(e instanceof Map)return Object.fromEntries(e);if(e instanceof Set)return Array.from(e);if(e instanceof Date)return e.toISOString();if(e instanceof RegExp)return e.toString();else if(e instanceof Error)return{name:e.name,message:e.message}}else if("bigint"==typeof e)return e.toString();return e}function ef(e,t,i,r,a){try{let t=JSON.stringify(e,function(e,t){if(i){let r=i.call(this,e,t);if(void 0!==r)return r}return em(t)},r);return ep(t)}catch(o){let n;if(!o.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${t?`
Context: ${t}`:""}`),ep("[Unserializable]");"true"!==T("SUPPRESS_CIRCULAR_JSON_WARNINGS")&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${t?`
Context: ${t}`:""}`),void 0===a&&(a={depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}),function e(t,i,r,a,s,n,o){if(n+=1,"object"==typeof t&&null!==t){for(l=0;l<a.length;l++)if(a[l]===t){e_(eu,t,i,s);return}if(void 0!==o.depthLimit&&n>o.depthLimit||void 0!==o.edgesLimit&&r+1>o.edgesLimit){e_("[...]",t,i,s);return}if(a.push(t),Array.isArray(t))for(l=0;l<t.length;l++)e(t[l],l,l,a,t,n,o);else{var l,u=Object.keys(t=em(t));for(l=0;l<u.length;l++){var h=u[l];e(t[h],h,l,a,t,n,o)}}a.pop()}}(e,"",0,[],void 0,0,a);try{var s;n=0===ed.length?JSON.stringify(e,i,r):JSON.stringify(e,(s=i,s=void 0!==s?s:function(e,t){return t},function(e,t){if(ed.length>0)for(var i=0;i<ed.length;i++){var r=ed[i];if(r[1]===e&&r[0]===t){t=r[2],ed.splice(i,1);break}}return s.call(this,e,t)}),r)}catch(e){return ep("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==eh.length;){let e=eh.pop();4===e.length?Object.defineProperty(e[0],e[1],e[3]):e[0][e[1]]=e[2]}}return ep(n)}}function e_(e,t,i,r){var a=Object.getOwnPropertyDescriptor(r,i);void 0!==a.get?a.configurable?(Object.defineProperty(r,i,{value:e}),eh.push([r,i,t,a])):ed.push([t,i,e]):(r[i]=e,eh.push([r,i,t]))}function eg(e){let t=S(),i=function(){let e=function(){try{if(void 0!==b&&b.env)return Object.entries(b.env).reduce((e,[t,i])=>(e[t]=String(i),e),{});return}catch(e){return}}()||{},t={},i=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[r,a]of Object.entries(e))(r.startsWith("LANGCHAIN_")||r.startsWith("LANGSMITH_"))&&"string"==typeof a&&!i.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&("LANGCHAIN_REVISION_ID"===r?t.revision_id=a:t[r]=a);return t}(),r=e.extra??{},a=r.metadata;return e.extra={...r,runtime:{...t,...r?.runtime},metadata:{...i,...i.revision_id||"revision_id"in e&&e.revision_id?{revision_id:("revision_id"in e?e.revision_id:void 0)??i.revision_id}:{},...a}},e}let eb=e=>{let t=e?.toString()??T("TRACING_SAMPLING_RATE");if(void 0===t)return;let i=parseFloat(t);if(i<0||i>1)throw Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${i}`);return i},ey=e=>{let t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t};async function ev(e){let t=[];for await(let i of e)t.push(i);return t}function ew(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}let eE=async e=>{if(e?.status===429){let t=1e3*parseInt(e.headers.get("retry-after")??"30",10);if(t>0)return await new Promise(e=>setTimeout(e,t)),!0}return!1};function e$(e){return"number"==typeof e?Number(e.toFixed(4)):e}class eI{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;let i=new Promise(e=>{t=e}),r=ef(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:i,size:r}),this.sizeBytes+=r,i}pop(e){if(e<1)throw Error("Number of bytes to pop off may not be less than 1.");let t=[],i=0;for(;i+(this.peek()?.size??0)<e&&this.items.length>0;){let e=this.items.shift();e&&(t.push(e),i+=e.size,this.sizeBytes-=e.size)}if(0===t.length&&this.items.length>0){let e=this.items.shift();t.push(e),i+=e.size,this.sizeBytes-=e.size}return[t.map(e=>({action:e.action,item:e.payload,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl})),()=>t.forEach(e=>e.itemPromiseResolve())]}}let eS="https://api.smith.langchain.com";class eO{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new eI}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:"false"===O("LANGSMITH_TRACING_BACKGROUND")}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:"true"===O("LANGSMITH_DEBUG")});let t=eO.getDefaultClientConfig();if(this.tracingSampleRate=eb(e.tracingSamplingRate),this.apiUrl=ew(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=ew(e.apiKey??t.apiKey),this.webUrl=ew(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new Q({...e.callerOptions??{},debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.batchIngestCaller=new Q({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:eE,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,A()&&(this.langSmithToOTELTranslator=new F)}static getDefaultClientConfig(){let e=T("API_KEY");return{apiUrl:T("ENDPOINT")??eS,apiKey:e,webUrl:void 0,hideInputs:"true"===T("HIDE_INPUTS"),hideOutputs:"true"===T("HIDE_OUTPUTS")}}getHostUrl(){if(this.webUrl)return this.webUrl;if(ey(this.apiUrl))return this.webUrl="http://localhost:3000",this.webUrl;if(this.apiUrl.endsWith("/api/v1"))return this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl;if(this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api"))return this.webUrl=this.apiUrl.replace("/api",""),this.webUrl;if(this.apiUrl.split(".",1)[0].includes("dev"))return this.webUrl="https://dev.smith.langchain.com",this.webUrl;if(this.apiUrl.split(".",1)[0].includes("eu"))return this.webUrl="https://eu.smith.langchain.com",this.webUrl;if(this.apiUrl.split(".",1)[0].includes("beta"))return this.webUrl="https://beta.smith.langchain.com",this.webUrl;else return this.webUrl="https://smith.langchain.com",this.webUrl}get headers(){let e={"User-Agent":`langsmith-js/${eM}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}_getPlatformEndpointPath(e){return"/v1"!==this.apiUrl.slice(-3)&&"/v1/"!==this.apiUrl.slice(-4)?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}async processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){let t={...e};return void 0!==t.inputs&&(t.inputs=await this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){let i=t?.toString()??"",r=`${this.apiUrl}${e}?${i}`,a=await this.caller.call(W(this.debug),r,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await en(a,`Failed to fetch ${e}`),a}async _get(e,t){return(await this._getResponse(e,t)).json()}async *_getPaginated(e,t=new URLSearchParams,i){let r=Number(t.get("offset"))||0,a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(a));let s=`${this.apiUrl}${e}?${t}`,n=await this.caller.call(W(this.debug),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(n,`Failed to fetch ${e}`);let o=i?i(await n.json()):await n.json();if(0===o.length||(yield o,o.length<a))break;r+=o.length}}async *_getCursorPaginatedList(e,t=null,i="POST",r="runs"){let a=t?{...t}:{};for(;;){let t=await this.caller.call(W(this.debug),`${this.apiUrl}${e}`,{method:i,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)}),s=await t.json();if(!s||!s[r])break;yield s[r];let n=s.cursors;if(!n||!n.next)break;a.cursor=n.next}}_shouldSample(){return void 0===this.tracingSampleRate||Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){let t=[];for(let i of e)this.filteredPostUuids.has(i.trace_id)?i.id===i.trace_id&&this.filteredPostUuids.delete(i.trace_id):t.push(i);return t}{let t=[];for(let i of e){let e=i.trace_id??i.id;this.filteredPostUuids.has(e)||(i.id===e?this._shouldSample()?t.push(i):this.filteredPostUuids.add(e):t.push(i))}return t}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??20971520}async _getMultiPartSupport(){let e=await this._ensureServerInfo();return e.instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue(e){let t=[];for(;this.autoBatchQueue.items.length>0;){let[i,r]=this.autoBatchQueue.pop(e);if(!i.length){r();break}let a=i.reduce((e,t)=>{let i=t.apiUrl??this.apiUrl,r=t.apiKey??this.apiKey,a=t.apiKey===this.apiKey&&t.apiUrl===this.apiUrl?"default":`${i}|${r}`;return e[a]||(e[a]=[]),e[a].push(t),e},{}),s=[];for(let[e,t]of Object.entries(a)){let i=this._processBatch(t,{apiUrl:"default"===e?void 0:e.split("|")[0],apiKey:"default"===e?void 0:e.split("|")[1]});s.push(i)}let n=Promise.all(s).finally(r);t.push(n)}return Promise.all(t)}async _processBatch(e,t){if(e.length)try{if(void 0!==this.langSmithToOTELTranslator)this._sendBatchToOTELTranslator(e);else{let i={runCreates:e.filter(e=>"create"===e.action).map(e=>e.item),runUpdates:e.filter(e=>"update"===e.action).map(e=>e.item)},r=await this._ensureServerInfo();r?.batch_ingest_config?.use_multipart_endpoint?await this.multipartIngestRuns(i,t):await this.batchIngestRuns(i,t)}}catch(e){console.error("Error exporting batch:",e)}}_sendBatchToOTELTranslator(e){if(void 0!==this.langSmithToOTELTranslator){let t=new Map,i=[];for(let r of e)r.item.id&&r.otelContext&&(t.set(r.item.id,r.otelContext),"create"===r.action?i.push({operation:"post",id:r.item.id,trace_id:r.item.trace_id??r.item.id,run:r.item}):i.push({operation:"patch",id:r.item.id,trace_id:r.item.trace_id??r.item.id,run:r.item}));this.langSmithToOTELTranslator.exportBatch(i,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=eg(e.item);let t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;let i=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>i&&this.drainAutoBatchQueue(i),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(i)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){let e=await this.caller.call(W(this.debug),`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(2500),...this.fetchOptions});await en(e,"get server info");let t=await e.json();return this.debug&&console.log("\n=== LangSmith Server Configuration ===\n"+JSON.stringify(t,null,2)+"\n"),t}async _ensureServerInfo(){return void 0===this._getServerInfoPromise&&(this._getServerInfoPromise=(async()=>{if(void 0===this._serverInfo)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[WARNING]: LangSmith failed to fetch info on supported operations with status code ${e.status}. Falling back to batch operations and default limits.`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(void 0===this._serverInfo&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){let e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}_cloneCurrentOTELContext(){let e=M(),t=D.getContextInstance();if(void 0!==this.langSmithToOTELTranslator){let i=e.getActiveSpan();if(i)return e.setSpan(t.active(),i)}}async createRun(e,t){if(!this._filterForSampling([e]).length)return;let i={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;let a=await this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==a.trace_id&&void 0!==a.dotted_order){let e=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:a,otelContext:e,apiKey:t?.apiKey,apiUrl:t?.apiUrl}).catch(console.error);return}let s=eg(a);t?.apiKey!==void 0&&(i["x-api-key"]=t.apiKey);let n=await this.caller.call(W(this.debug),`${t?.apiUrl??this.apiUrl}/runs`,{method:"POST",headers:i,body:ef(s,`Creating run with id: ${s.id}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(n,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t},i){if(void 0===e&&void 0===t)return;let r=await Promise.all(e?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]),a=await Promise.all(t?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]);if(r.length>0&&a.length>0){let e=r.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let i of a)void 0!==i.id&&e[i.id]?e[i.id]={...e[i.id],...i}:t.push(i);r=Object.values(e),a=t}let s={post:r,patch:a};if(!s.post.length&&!s.patch.length)return;let n={post:[],patch:[]};for(let e of["post","patch"]){let t=s[e].reverse(),i=t.pop();for(;void 0!==i;)n[e].push(i),i=t.pop()}if(n.post.length>0||n.patch.length>0){let e=n.post.map(e=>e.id).concat(n.patch.map(e=>e.id)).join(",");await this._postBatchIngestRuns(ef(n,`Ingesting runs with ids: ${e}`),i)}}async _postBatchIngestRuns(e,t){let i={...this.headers,"Content-Type":"application/json",Accept:"application/json"};t?.apiKey!==void 0&&(i["x-api-key"]=t.apiKey);let r=await this.batchIngestCaller.call(W(this.debug),`${t?.apiUrl??this.apiUrl}/runs/batch`,{method:"POST",headers:i,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t},i){if(void 0===e&&void 0===t)return;let r={},a=[];for(let t of e??[]){let e=await this.prepareRunCreateOrUpdateInputs(t);void 0!==e.id&&void 0!==e.attachments&&(r[e.id]=e.attachments),delete e.attachments,a.push(e)}let s=[];for(let e of t??[])s.push(await this.prepareRunCreateOrUpdateInputs(e));if(void 0!==a.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(void 0!==s.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&s.length>0){let e=a.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let i of s)void 0!==i.id&&e[i.id]?e[i.id]={...e[i.id],...i}:t.push(i);a=Object.values(e),s=t}if(0===a.length&&0===s.length)return;let n=[],o=[];for(let[e,t]of[["post",a],["patch",s]])for(let i of t){let{inputs:t,outputs:a,events:s,extra:l,error:u,serialized:h,attachments:d,...c}=i,p={inputs:t,outputs:a,events:s,extra:l,error:u,serialized:h},m=ef(c,`Serializing for multipart ingestion of run with id: ${c.id}`);for(let[t,i]of(o.push({name:`${e}.${c.id}`,payload:new Blob([m],{type:`application/json; length=${m.length}`})}),Object.entries(p))){if(void 0===i)continue;let r=ef(i,`Serializing ${t} for multipart ingestion of run with id: ${c.id}`);o.push({name:`${e}.${c.id}.${t}`,payload:new Blob([r],{type:`application/json; length=${r.length}`})})}if(void 0!==c.id){let e=r[c.id];if(e)for(let[t,i]of(delete r[c.id],Object.entries(e))){let e,r;if(Array.isArray(i)?[e,r]=i:(e=i.mimeType,r=i.data),t.includes(".")){console.warn(`Skipping attachment '${t}' for run ${c.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}o.push({name:`attachment.${c.id}.${t}`,payload:new Blob([r],{type:`${e}; length=${r.byteLength}`})})}}n.push(`trace=${c.trace_id},id=${c.id}`)}await this._sendMultipartRequest(o,n.join("; "),i)}async _createNodeFetchBody(e,t){let i=[];for(let r of e)i.push(new Blob([`--${t}\r
`])),i.push(new Blob([`Content-Disposition: form-data; name="${r.name}"\r
`,`Content-Type: ${r.payload.type}\r
\r
`])),i.push(r.payload),i.push(new Blob(["\r\n"]));i.push(new Blob([`--${t}--\r
`]));let r=new Blob(i);return await r.arrayBuffer()}async _createMultipartStream(e,t){let i=new TextEncoder;return new ReadableStream({async start(r){let a=async e=>{"string"==typeof e?r.enqueue(i.encode(e)):r.enqueue(e)};for(let i of e){await a(`--${t}\r
`),await a(`Content-Disposition: form-data; name="${i.name}"\r
`),await a(`Content-Type: ${i.payload.type}\r
\r
`);let e=i.payload.stream().getReader();try{let t;for(;!(t=await e.read()).done;)r.enqueue(t.value)}finally{e.releaseLock()}await a("\r\n")}await a(`--${t}--\r
`),r.close()}})}async _sendMultipartRequest(e,t,i){let r="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),a=K(),s=()=>this._createNodeFetchBody(e,r),n=async e=>{let t={...this.headers,"Content-Type":`multipart/form-data; boundary=${r}`};return i?.apiKey!==void 0&&(t["x-api-key"]=i.apiKey),this.batchIngestCaller.call(W(this.debug),`${i?.apiUrl??this.apiUrl}/runs/multipart`,{method:"POST",headers:t,body:e,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})};try{let o;let l=!1;a||this.multipartStreamingDisabled?o=await n(await s()):(l=!0,o=await n(await this._createMultipartStream(e,r))),(!this.multipartStreamingDisabled||l)&&422===o.status&&(i?.apiUrl??this.apiUrl)!==eS&&(console.warn(`Streaming multipart upload to ${i?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,o=await n(await s())),await en(o,"ingest multipart runs",!0)}catch(e){console.warn(`${e.message.trim()}

Context: ${t}`)}}async updateRun(e,t,i){et(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));let r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order){let e=this._cloneCurrentOTELContext();void 0!==t.end_time&&void 0===r.parent_run_id&&this.blockOnRootRunFinalization&&!this.manualFlushMode?await this.processRunOperation({action:"update",item:r,otelContext:e,apiKey:i?.apiKey,apiUrl:i?.apiUrl}).catch(console.error):this.processRunOperation({action:"update",item:r,otelContext:e,apiKey:i?.apiKey,apiUrl:i?.apiUrl}).catch(console.error);return}let a={...this.headers,"Content-Type":"application/json"};i?.apiKey!==void 0&&(a["x-api-key"]=i.apiKey);let s=await this.caller.call(W(this.debug),`${i?.apiUrl??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,body:ef(t,`Serializing payload to update run with id: ${e}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(s,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){et(e);let i=await this._get(`/runs/${e}`);return t&&(i=await this._loadChildRuns(i)),i}async getRunUrl({runId:e,run:t,projectOpts:i}){if(void 0!==t){let e;e=t.session_id?t.session_id:i?.projectName?(await this.readProject({projectName:i?.projectName})).id:i?.projectId?i?.projectId:(await this.readProject({projectName:T("PROJECT")||"default"})).id;let r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){let t=await this.readRun(e);if(!t.app_path)throw Error(`Run ${e} has no app_path`);let i=this.getHostUrl();return`${i}${t.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await ev(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),i={},r={};for(let a of(t.sort((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")),t)){if(null===a.parent_run_id||void 0===a.parent_run_id)throw Error(`Child run ${a.id} has no parent`);a.dotted_order?.startsWith(e.dotted_order??"")&&a.id!==e.id&&(a.parent_run_id in i||(i[a.parent_run_id]=[]),i[a.parent_run_id].push(a),r[a.id]=a)}for(let t in e.child_runs=i[e.id]||[],i)t!==e.id&&(r[t].child_runs=i[t]);return e}async *listRuns(e){let{projectId:t,projectName:i,parentRunId:r,traceId:a,referenceExampleId:s,startTime:n,executionOrder:o,isRoot:l,runType:u,error:h,id:d,query:c,filter:p,traceFilter:m,treeFilter:f,limit:_,select:g,order:b}=e,y=[];if(t&&(y=Array.isArray(t)?t:[t]),i){let e=Array.isArray(i)?i:[i],t=await Promise.all(e.map(e=>this.readProject({projectName:e}).then(e=>e.id)));y.push(...t)}let v={session:y.length?y:null,run_type:u,reference_example:s,query:c,filter:p,trace_filter:m,tree_filter:f,execution_order:o,parent_run:r,start_time:n?n.toISOString():null,error:h,id:d,limit:_,trace:a,select:g||["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:l,order:b},w=0;for await(let e of this._getCursorPaginatedList("/runs/query",v))if(_){if(w>=_)break;if(e.length+w>_){let t=e.slice(0,_-w);yield*t;break}w+=e.length,yield*e}else yield*e}async *listGroupRuns(e){let{projectId:t,projectName:i,groupBy:r,filter:a,startTime:s,endTime:n,limit:o,offset:l}=e,u={session_id:t||(await this.readProject({projectName:i})).id,group_by:r,filter:a,start_time:s?s.toISOString():null,end_time:n?n.toISOString():null,limit:Number(o)||100},h=Number(l)||0,d="/runs/group",c=`${this.apiUrl}${d}`;for(;;){let e=Object.fromEntries(Object.entries({...u,offset:h}).filter(([e,t])=>void 0!==t)),t=await this.caller.call(W(),c,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(t,`Failed to fetch ${d}`);let{groups:i,total:r}=await t.json();if(0===i.length)break;for(let e of i)yield e;if((h+=i.length)>=r)break}}async getRunStats({id:e,trace:t,parentRun:i,runType:r,projectNames:a,projectIds:s,referenceExampleIds:n,startTime:o,endTime:l,error:u,query:h,filter:d,traceFilter:c,treeFilter:p,isRoot:m,dataSourceType:f}){let _=s||[];a&&(_=[...s||[],...await Promise.all(a.map(e=>this.readProject({projectName:e}).then(e=>e.id)))]);let g=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:i,run_type:r,session:_,reference_example:n,start_time:o,end_time:l,error:u,query:h,filter:d,trace_filter:c,tree_filter:p,is_root:m,data_source_type:f}).filter(([e,t])=>void 0!==t)),b=await this.caller.call(W(this.debug),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(g),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await b.json()}async shareRun(e,{shareId:t}={}){let i={run_id:e,share_token:t||c()};et(e);let r=await this.caller.call(W(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await r.json();if(null===a||!("share_token"in a))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){et(e);let t=await this.caller.call(W(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(t,"unshare run",!0)}async readRunSharedLink(e){et(e);let t=await this.caller.call(W(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await t.json();if(null!==i&&"share_token"in i)return`${this.getHostUrl()}/public/${i.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let i=new URLSearchParams({share_token:e});if(void 0!==t)for(let e of t)i.append("id",e);et(e);let r=await this.caller.call(W(this.debug),`${this.apiUrl}/public/${e}/runs${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await r.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),et(e);let i=await this.caller.call(W(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await i.json();return r.url=`${this.getHostUrl()}/public/${r.share_token}/d`,r}async shareDataset(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let i={dataset_id:e};et(e);let r=await this.caller.call(W(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await r.json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){et(e);let t=await this.caller.call(W(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(t,"unshare dataset",!0)}async readSharedDataset(e){et(e);let t=await this.caller.call(W(this.debug),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await t.json()}async listSharedExamples(e,t){let i={};t?.exampleIds&&(i.id=t.exampleIds);let r=new URLSearchParams;Object.entries(i).forEach(([e,t])=>{Array.isArray(t)?t.forEach(t=>r.append(e,t)):r.append(e,t)});let a=await this.caller.call(W(this.debug),`${this.apiUrl}/public/${e}/examples?${r.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),s=await a.json();if(!a.ok){if("detail"in s)throw Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${Array.isArray(s.detail)?s.detail.join("\n"):"Unspecified error"}`);throw Error(`Failed to list shared examples: ${a.status} ${a.statusText}`)}return s.map(e=>({...e,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:i=null,upsert:r=!1,projectExtra:a=null,referenceDatasetId:s=null}){let n=`${this.apiUrl}/sessions${r?"?upsert=true":""}`,o=a||{};i&&(o.metadata=i);let l={name:e,extra:o,description:t};null!==s&&(l.reference_dataset_id=s);let u=await this.caller.call(W(this.debug),n,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await en(u,"create project"),await u.json()}async updateProject(e,{name:t=null,description:i=null,metadata:r=null,projectExtra:a=null,endTime:s=null}){let n=`${this.apiUrl}/sessions/${e}`,o=a;r&&(o={...o||{},metadata:r});let l={name:t,extra:o,description:i,end_time:s?new Date(s).toISOString():null},u=await this.caller.call(W(this.debug),n,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await en(u,"update project"),await u.json()}async hasProject({projectId:e,projectName:t}){let i="/sessions",r=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)et(e),i+=`/${e}`;else if(void 0!==t)r.append("name",t);else throw Error("Must provide projectName or projectId");let a=await this.caller.call(W(this.debug),`${this.apiUrl}${i}?${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{let e=await a.json();if(!a.ok)return!1;if(Array.isArray(e))return e.length>0;return!0}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:i}){let r,a="/sessions",s=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)et(e),a+=`/${e}`;else if(void 0!==t)s.append("name",t);else throw Error("Must provide projectName or projectId");void 0!==i&&s.append("include_stats",i.toString());let n=await this._get(a,s);if(Array.isArray(n)){if(0===n.length)throw Error(`Project[id=${e}, name=${t}] not found`);r=n[0]}else r=n;return r}async getProjectUrl({projectId:e,projectName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either projectName or projectId");let i=await this.readProject({projectId:e,projectName:t}),r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/projects/p/${i.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either datasetName or datasetId");let i=await this.readDataset({datasetId:e,datasetName:t}),r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/datasets/${i.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:e,name:t,nameContains:i,referenceDatasetId:r,referenceDatasetName:a,referenceFree:s,metadata:n}={}){let o=new URLSearchParams;if(void 0!==e)for(let t of e)o.append("id",t);if(void 0!==t&&o.append("name",t),void 0!==i&&o.append("name_contains",i),void 0!==r)o.append("reference_dataset",r);else if(void 0!==a){let e=await this.readDataset({datasetName:a});o.append("reference_dataset",e.id)}for await(let e of(void 0!==s&&o.append("reference_free",s.toString()),void 0!==n&&o.append("metadata",JSON.stringify(n)),this._getPaginated("/sessions",o)))yield*e}async deleteProject({projectId:e,projectName:t}){let i;if(void 0===e&&void 0===t)throw Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");et(i=void 0===e?(await this.readProject({projectName:t})).id:e);let r=await this.caller.call(W(this.debug),`${this.apiUrl}/sessions/${i}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(r,`delete session ${i} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:i,outputKeys:r,description:a,dataType:s,name:n}){let o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),i.forEach(e=>{l.append("input_keys",e)}),r.forEach(e=>{l.append("output_keys",e)}),a&&l.append("description",a),s&&l.append("data_type",s),n&&l.append("name",n);let u=await this.caller.call(W(this.debug),o,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await en(u,"upload CSV"),await u.json()}async createDataset(e,{description:t,dataType:i,inputsSchema:r,outputsSchema:a,metadata:s}={}){let n={name:e,description:t,extra:s?{metadata:s}:void 0};i&&(n.data_type=i),r&&(n.inputs_schema_definition=r),a&&(n.outputs_schema_definition=a);let o=await this.caller.call(W(this.debug),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await en(o,"create dataset"),await o.json()}async readDataset({datasetId:e,datasetName:t}){let i,r="/datasets",a=new URLSearchParams({limit:"1"});if(e&&t)throw Error("Must provide either datasetName or datasetId, not both");if(e)et(e),r+=`/${e}`;else if(t)a.append("name",t);else throw Error("Must provide datasetName or datasetId");let s=await this._get(r,a);if(Array.isArray(s)){if(0===s.length)throw Error(`Dataset[id=${e}, name=${t}] not found`);i=s[0]}else i=s;return i}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(e){if(e instanceof Error&&e.message.toLocaleLowerCase().includes("not found"))return!1;throw e}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:i,toVersion:r}){let a=e;if(void 0===a&&void 0===t)throw Error("Must provide either datasetName or datasetId");if(void 0!==a&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");void 0===a&&(a=(await this.readDataset({datasetName:t})).id);let s=new URLSearchParams({from_version:"string"==typeof i?i:i.toISOString(),to_version:"string"==typeof r?r:r.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,s)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else if(void 0!==t)e=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide either datasetName or datasetId");let i=await this._getResponse(`/datasets/${e}/openai_ft`);return(await i.text()).trim().split("\n").map(e=>JSON.parse(e))}async *listDatasets({limit:e=100,offset:t=0,datasetIds:i,datasetName:r,datasetNameContains:a,metadata:s}={}){let n=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==i)for(let e of i)n.append("id",e);for await(let e of(void 0!==r&&n.append("name",r),void 0!==a&&n.append("name_contains",a),void 0!==s&&n.append("metadata",JSON.stringify(s)),this._getPaginated("/datasets",n)))yield*e}async updateDataset(e){let{datasetId:t,datasetName:i,...r}=e;if(!t&&!i)throw Error("Must provide either datasetName or datasetId");let a=t??(await this.readDataset({datasetName:i})).id;et(a);let s=await this.caller.call(W(this.debug),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await en(s,"update dataset"),await s.json()}async updateDatasetTag(e){let{datasetId:t,datasetName:i,asOf:r,tag:a}=e;if(!t&&!i)throw Error("Must provide either datasetName or datasetId");let s=t??(await this.readDataset({datasetName:i})).id;et(s);let n=await this.caller.call(W(this.debug),`${this.apiUrl}/datasets/${s}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:"string"==typeof r?r:r.toISOString(),tag:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(n,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let i="/datasets",r=e;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(r=(await this.readDataset({datasetName:t})).id),void 0!==r)et(r),i+=`/${r}`;else throw Error("Must provide datasetName or datasetId");let a=await this.caller.call(W(this.debug),this.apiUrl+i,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(a,`delete ${i}`),await a.json()}async indexDataset({datasetId:e,datasetName:t,tag:i}){let r=e;if(r||t){if(r&&t)throw Error("Must provide either datasetName or datasetId, not both");r||(r=(await this.readDataset({datasetName:t})).id)}else throw Error("Must provide either datasetName or datasetId");et(r);let a=await this.caller.call(W(this.debug),`${this.apiUrl}/datasets/${r}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({tag:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(a,"index dataset"),await a.json()}async similarExamples(e,t,i,{filter:r}={}){let a={limit:i,inputs:e};void 0!==r&&(a.filter=r),et(t);let s=await this.caller.call(W(this.debug),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await en(s,"fetch similar examples"),(await s.json()).examples}async createExample(e,t,i){let r;if(eT(e)&&(void 0!==t||void 0!==i))throw Error("Cannot provide outputs or options when using ExampleCreate object");let a=t?i?.datasetId:e.dataset_id,s=t?i?.datasetName:e.dataset_name;if(void 0===a&&void 0===s)throw Error("Must provide either datasetName or datasetId");if(void 0!==a&&void 0!==s)throw Error("Must provide either datasetName or datasetId, not both");void 0===a&&(a=(await this.readDataset({datasetName:s})).id);let n=(t?i?.createdAt:e.created_at)||new Date;r=eT(e)?e:{inputs:e,outputs:t,created_at:n?.toISOString(),id:i?.exampleId,metadata:i?.metadata,split:i?.split,source_run_id:i?.sourceRunId,use_source_run_io:i?.useSourceRunIO,use_source_run_attachments:i?.useSourceRunAttachments,attachments:i?.attachments};let o=await this._uploadExamplesMultipart(a,[r]);return await this.readExample(o.example_ids?.[0]??c())}async createExamples(e){if(Array.isArray(e)){if(0===e.length)return[];let t=e[0].dataset_id,i=e[0].dataset_name;if(void 0===t&&void 0===i)throw Error("Must provide either datasetName or datasetId");if(void 0!==t&&void 0!==i)throw Error("Must provide either datasetName or datasetId, not both");void 0===t&&(t=(await this.readDataset({datasetName:i})).id);let r=await this._uploadExamplesMultipart(t,e);return await Promise.all(r.example_ids.map(e=>this.readExample(e)))}let{inputs:t,outputs:i,metadata:r,splits:a,sourceRunIds:s,useSourceRunIOs:n,useSourceRunAttachments:o,attachments:l,exampleIds:u,datasetId:h,datasetName:d}=e;if(void 0===t)throw Error("Must provide inputs when using legacy parameters");let c=h;if(void 0===c&&void 0===d)throw Error("Must provide either datasetName or datasetId");if(void 0!==c&&void 0!==d)throw Error("Must provide either datasetName or datasetId, not both");void 0===c&&(c=(await this.readDataset({datasetName:d})).id);let p=t.map((e,t)=>({dataset_id:c,inputs:e,outputs:i?.[t],metadata:r?.[t],split:a?.[t],id:u?.[t],attachments:l?.[t],source_run_id:s?.[t],use_source_run_io:n?.[t],use_source_run_attachments:o?.[t]})),m=await this._uploadExamplesMultipart(c,p);return await Promise.all(m.example_ids.map(e=>this.readExample(e)))}async createLLMExample(e,t,i){return this.createExample({input:e},{output:t},i)}async createChatExample(e,t,i){let r=e.map(e=>Y(e)?Z(e):e),a=Y(t)?Z(t):t;return this.createExample({input:r},{output:a},i)}async readExample(e){et(e);let t=`/examples/${e}`,{attachment_urls:i,...r}=await this._get(t);return i&&(r.attachments=Object.entries(i).reduce((e,[t,i])=>(e[t.slice("attachment.".length)]={presigned_url:i.presigned_url,mime_type:i.mime_type},e),{})),r}async *listExamples({datasetId:e,datasetName:t,exampleIds:i,asOf:r,splits:a,inlineS3Urls:s,metadata:n,limit:o,offset:l,filter:u,includeAttachments:h}={}){let d;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)d=e;else if(void 0!==t)d=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide a datasetName or datasetId");let c=new URLSearchParams({dataset:d}),p=r?"string"==typeof r?r:r?.toISOString():void 0;if(p&&c.append("as_of",p),c.append("inline_s3_urls",(s??!0).toString()),void 0!==i)for(let e of i)c.append("id",e);if(void 0!==a)for(let e of a)c.append("splits",e);if(void 0!==n){let e=JSON.stringify(n);c.append("metadata",e)}void 0!==o&&c.append("limit",o.toString()),void 0!==l&&c.append("offset",l.toString()),void 0!==u&&c.append("filter",u),!0===h&&["attachment_urls","outputs","metadata"].forEach(e=>c.append("select",e));let m=0;for await(let e of this._getPaginated("/examples",c)){for(let t of e){let{attachment_urls:e,...i}=t;e&&(i.attachments=Object.entries(e).reduce((e,[t,i])=>(e[t.slice("attachment.".length)]={presigned_url:i.presigned_url,mime_type:i.mime_type||void 0},e),{})),yield i,m++}if(void 0!==o&&m>=o)break}}async deleteExample(e){et(e);let t=`/examples/${e}`,i=await this.caller.call(W(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(i,`delete ${t}`),await i.json()}async updateExample(e,t){let i,r,a;return et(i=t?e:e.id),a=void 0!==(r=t?{id:i,...t}:e).dataset_id?r.dataset_id:(await this.readExample(i)).dataset_id,this._updateExamplesMultipart(a,[r])}async updateExamples(e){let t;return t=void 0===e[0].dataset_id?(await this.readExample(e[0].id)).dataset_id:e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:i,tag:r}){let a;if(et(a=e||(await this.readDataset({datasetName:t})).id),i&&r||!i&&!r)throw Error("Exactly one of asOf and tag must be specified.");let s=new URLSearchParams;void 0!==i&&s.append("as_of","string"==typeof i?i:i.toISOString()),void 0!==r&&s.append("tag",r);let n=await this.caller.call(W(this.debug),`${this.apiUrl}/datasets/${a}/version?${s.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await en(n,"read dataset version"),await n.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:i}){let r;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");et(r=void 0===e?(await this.readDataset({datasetName:t})).id:e);let a=new URLSearchParams,s=i?"string"==typeof i?i:i?.toISOString():void 0;return s&&a.append("as_of",s),await this._get(`/datasets/${r}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:i,exampleIds:r,remove:a=!1}){let s;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");et(s=void 0===e?(await this.readDataset({datasetName:t})).id:e);let n={split_name:i,examples:r.map(e=>(et(e),e)),remove:a},o=await this.caller.call(W(this.debug),`${this.apiUrl}/datasets/${s}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(o,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:i,loadChildRuns:r,referenceExample:a}={loadChildRuns:!1}){let s;if(er("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead."),"string"==typeof e)s=await this.readRun(e,{loadChildRuns:r});else if("object"==typeof e&&"id"in e)s=e;else throw Error(`Invalid run type: ${typeof e}`);null!==s.reference_example_id&&void 0!==s.reference_example_id&&(a=await this.readExample(s.reference_example_id));let n=await t.evaluateRun(s,a),[o,l]=await this._logEvaluationFeedback(n,s,i);return l[0]}async createFeedback(e,t,{score:i,value:r,correction:a,comment:s,sourceInfo:n,feedbackSourceType:o="api",sourceRunId:l,feedbackId:u,feedbackConfig:h,projectId:d,comparativeExperimentId:p}){if(!e&&!d)throw Error("One of runId or projectId must be provided");if(e&&d)throw Error("Only one of runId or projectId can be provided");let m={type:o??"api",metadata:n??{}};void 0===l||m?.metadata===void 0||m.metadata.__run||(m.metadata.__run={run_id:l}),m?.metadata!==void 0&&m.metadata.__run?.run_id!==void 0&&et(m.metadata.__run.run_id);let f={id:u??c(),run_id:e,key:t,score:e$(i),value:r,correction:a,comment:s,feedback_source:m,comparative_experiment_id:p,feedbackConfig:h,session_id:d},_=`${this.apiUrl}/feedback`,g=await this.caller.call(W(this.debug),_,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await en(g,"create feedback",!0),f}async updateFeedback(e,{score:t,value:i,correction:r,comment:a}){let s={};null!=t&&(s.score=e$(t)),null!=i&&(s.value=i),null!=r&&(s.correction=r),null!=a&&(s.comment=a),et(e);let n=await this.caller.call(W(this.debug),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(n,"update feedback",!0)}async readFeedback(e){et(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){et(e);let t=`/feedback/${e}`,i=await this.caller.call(W(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(i,`delete ${t}`),await i.json()}async *listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:i}={}){let r=new URLSearchParams;if(e&&r.append("run",e.join(",")),t)for(let e of t)r.append("key",e);if(i)for(let e of i)r.append("source",e);for await(let e of this._getPaginated("/feedback",r))yield*e}async createPresignedFeedbackToken(e,t,{expiration:i,feedbackConfig:r}={}){let a={run_id:e,feedback_key:t,feedback_config:r};i?"string"==typeof i?a.expires_at=i:(i?.hours||i?.minutes||i?.days)&&(a.expires_in=i):a.expires_in={hours:3};let s=await this.caller.call(W(this.debug),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await s.json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:i,createdAt:r,description:a,metadata:s,id:n}){if(0===t.length)throw Error("At least one experiment is required");if(i||(i=(await this.readProject({projectId:t[0]})).reference_dataset_id),null==!i)throw Error("A reference dataset is required");let o={id:n,name:e,experiment_ids:t,reference_dataset_id:i,description:a,created_at:(r??new Date)?.toISOString(),extra:{}};s&&(o.extra.metadata=s);let l=await this.caller.call(W(this.debug),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await l.json()}async *listPresignedFeedbackTokens(e){et(e);let t=new URLSearchParams({run_id:e});for await(let e of this._getPaginated("/feedback/tokens",t))yield*e}_selectEvalResults(e){return"results"in e?e.results:Array.isArray(e)?e:[e]}async _logEvaluationFeedback(e,t,i){let r=this._selectEvalResults(e),a=[];for(let e of r){let r=i||{};e.evaluatorInfo&&(r={...e.evaluatorInfo,...r});let s=null;e.targetRunId?s=e.targetRunId:t&&(s=t.id),a.push(await this.createFeedback(s,e.key,{score:e.score,value:e.value,comment:e.comment,correction:e.correction,sourceInfo:r,sourceRunId:e.sourceRunId,feedbackConfig:e.feedbackConfig,feedbackSourceType:"model"}))}return[r,a]}async logEvaluationFeedback(e,t,i){let[r]=await this._logEvaluationFeedback(e,t,i);return r}async *listAnnotationQueues(e={}){let{queueIds:t,name:i,nameContains:r,limit:a}=e,s=new URLSearchParams;t&&t.forEach((e,t)=>{et(e,`queueIds[${t}]`),s.append("ids",e)}),i&&s.append("name",i),r&&s.append("name_contains",r),s.append("limit",(void 0!==a?Math.min(a,100):100).toString());let n=0;for await(let e of this._getPaginated("/annotation-queues",s))if(yield*e,n++,void 0!==a&&n>=a)break}async createAnnotationQueue(e){let{name:t,description:i,queueId:r,rubricInstructions:a}=e,s={name:t,description:i,id:r||c(),rubric_instructions:a},n=await this.caller.call(W(this.debug),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(s).filter(([e,t])=>void 0!==t))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await en(n,"create annotation queue"),await n.json()}async readAnnotationQueue(e){let t=await this.caller.call(W(this.debug),`${this.apiUrl}/annotation-queues/${et(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await en(t,"read annotation queue"),await t.json()}async updateAnnotationQueue(e,t){let{name:i,description:r,rubricInstructions:a}=t,s=await this.caller.call(W(this.debug),`${this.apiUrl}/annotation-queues/${et(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:i,description:r,rubric_instructions:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(s,"update annotation queue")}async deleteAnnotationQueue(e){let t=await this.caller.call(W(this.debug),`${this.apiUrl}/annotation-queues/${et(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){let i=await this.caller.call(W(this.debug),`${this.apiUrl}/annotation-queues/${et(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((e,t)=>et(e,`runIds[${t}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(i,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){let i=`/annotation-queues/${et(e,"queueId")}/run`,r=await this.caller.call(W(this.debug),`${this.apiUrl}${i}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await en(r,"get run from annotation queue"),await r.json()}async deleteRunFromAnnotationQueue(e,t){let i=await this.caller.call(W(this.debug),`${this.apiUrl}/annotation-queues/${et(e,"queueId")}/runs/${et(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(i,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){let t=await this.caller.call(W(this.debug),`${this.apiUrl}/annotation-queues/${et(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await en(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){let t=await this._getSettings();return"-"==e||t.tenant_handle===e}async _ownerConflictError(e,t){let i=await this._getSettings();return Error(`Cannot ${e} for another tenant.

      Current tenant: ${i.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){let t=await this.caller.call(W(this.debug),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await t.json();if(!t.ok){let e="string"==typeof i.detail?i.detail:JSON.stringify(i.detail),r=Error(`Error ${t.status}: ${t.statusText}
${e}`);throw r.statusCode=t.status,r}if(0!==i.commits.length)return i.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){let[i,r,a]=ea(e),s=await this.caller.call(W(this.debug),`${this.apiUrl}/likes/${i}/${r}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await en(s,`${t?"like":"unlike"} prompt`),await s.json()}async _getPromptUrl(e){let[t,i,r]=ea(e);if(await this._currentTenantIsOwner(t)){let e=await this._getSettings();return"latest"!==r?`${this.getHostUrl()}/prompts/${i}/${r.substring(0,8)}?organizationId=${e.id}`:`${this.getHostUrl()}/prompts/${i}?organizationId=${e.id}`}return"latest"!==r?`${this.getHostUrl()}/hub/${t}/${i}/${r.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${i}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async *listCommits(e){for await(let t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,e=>e.commits))yield*t}async *listPrompts(e){let t=new URLSearchParams;for await(let i of(t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query),this._getPaginated("/repos",t,e=>e.repos)))yield*i}async getPrompt(e){let[t,i,r]=ea(e),a=await this.caller.call(W(this.debug),`${this.apiUrl}/repos/${t}/${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(404===a.status)return null;await en(a,"get prompt");let s=await a.json();return s.repo?s.repo:null}async createPrompt(e,t){let i=await this._getSettings();if(t?.isPublic&&!i.tenant_handle)throw Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[r,a,s]=ea(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("create a prompt",r);let n={repo_handle:a,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic},o=await this.caller.call(W(this.debug),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(o,"create prompt");let{repo:l}=await o.json();return l}async createCommit(e,t,i){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[r,a,s]=ea(e),n=i?.parentCommitHash!=="latest"&&i?.parentCommitHash?i?.parentCommitHash:await this._getLatestCommitHash(`${r}/${a}`),o={manifest:JSON.parse(JSON.stringify(t)),parent_commit:n},l=await this.caller.call(W(this.debug),`${this.apiUrl}/commits/${r}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(l,"create commit");let u=await l.json();return this._getPromptUrl(`${r}/${a}${u.commit_hash?`:${u.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let i=new FormData;for(let e of t){let t=e.id,r=new Blob([ef({...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split}},`Serializing body for example with id: ${t}`)],{type:"application/json"});if(i.append(t,r),e.inputs){let r=new Blob([ef(e.inputs,`Serializing inputs for example with id: ${t}`)],{type:"application/json"});i.append(`${t}.inputs`,r)}if(e.outputs){let r=new Blob([ef(e.outputs,`Serializing outputs whle updating example with id: ${t}`)],{type:"application/json"});i.append(`${t}.outputs`,r)}if(e.attachments)for(let[r,a]of Object.entries(e.attachments)){let e,s;Array.isArray(a)?[e,s]=a:(e=a.mimeType,s=a.data);let n=new Blob([s],{type:`${e}; length=${s.byteLength}`});i.append(`${t}.attachment.${r}`,n)}if(e.attachments_operations){let r=new Blob([ef(e.attachments_operations,`Serializing attachments while updating example with id: ${t}`)],{type:"application/json"});i.append(`${t}.attachments_operations`,r)}}let r=e??t[0]?.dataset_id,a=await this.caller.call(W(this.debug),`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${r}/examples`)}`,{method:"PATCH",headers:this.headers,body:i});return await a.json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let i=new FormData;for(let e of t){let t=(e.id??c()).toString(),r=new Blob([ef({created_at:e.created_at,...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split},...e.source_run_id&&{source_run_id:e.source_run_id},...e.use_source_run_io&&{use_source_run_io:e.use_source_run_io},...e.use_source_run_attachments&&{use_source_run_attachments:e.use_source_run_attachments}},`Serializing body for uploaded example with id: ${t}`)],{type:"application/json"});if(i.append(t,r),e.inputs){let r=new Blob([ef(e.inputs,`Serializing inputs for uploaded example with id: ${t}`)],{type:"application/json"});i.append(`${t}.inputs`,r)}if(e.outputs){let r=new Blob([ef(e.outputs,`Serializing outputs for uploaded example with id: ${t}`)],{type:"application/json"});i.append(`${t}.outputs`,r)}if(e.attachments)for(let[r,a]of Object.entries(e.attachments)){let e,s;Array.isArray(a)?[e,s]=a:(e=a.mimeType,s=a.data);let n=new Blob([s],{type:`${e}; length=${s.byteLength}`});i.append(`${t}.attachment.${r}`,n)}}let r=await this.caller.call(W(this.debug),`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,body:i});return await en(r,"upload examples"),await r.json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[i,r]=ea(e);if(!await this._currentTenantIsOwner(i))throw await this._ownerConflictError("update a prompt",i);let a={};if(t?.description!==void 0&&(a.description=t.description),t?.readme!==void 0&&(a.readme=t.readme),t?.tags!==void 0&&(a.tags=t.tags),t?.isPublic!==void 0&&(a.is_public=t.isPublic),t?.isArchived!==void 0&&(a.is_archived=t.isArchived),0===Object.keys(a).length)throw Error("No valid update options provided");let s=await this.caller.call(W(this.debug),`${this.apiUrl}/repos/${i}/${r}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await en(s,"update prompt"),s.json()}async deletePrompt(e){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[t,i,r]=ea(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);let a=await this.caller.call(W(this.debug),`${this.apiUrl}/repos/${t}/${i}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await a.json()}async pullPromptCommit(e,t){let[i,r,a]=ea(e),s=await this.caller.call(W(this.debug),`${this.apiUrl}/commits/${i}/${r}/${a}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await en(s,"pull prompt commit");let n=await s.json();return{owner:i,repo:r,commit_hash:n.commit_hash,manifest:n.manifest,examples:n.examples}}async _pullPrompt(e,t){return JSON.stringify((await this.pullPromptCommit(e,{includeModel:t?.includeModel})).manifest)}async pushPrompt(e,t){return(await this.promptExists(e)?t&&Object.keys(t).some(e=>"object"!==e)&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object)?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){let{sourceApiUrl:i=this.apiUrl,datasetName:r}=t,[a,s]=this.parseTokenOrUrl(e,i),n=new eO({apiUrl:a,apiKey:"placeholder"}),o=await n.readSharedDataset(s),l=r||o.name;try{if(await this.hasDataset({datasetId:l})){console.log(`Dataset ${l} already exists in your tenant. Skipping.`);return}}catch(e){}let u=await n.listSharedExamples(s),h=await this.createDataset(l,{description:o.description,dataType:o.data_type||"kv",inputsSchema:o.inputs_schema_definition??void 0,outputsSchema:o.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(e=>e.inputs),outputs:u.flatMap(e=>e.outputs?[e.outputs]:[]),datasetId:h.id})}catch(e){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),e}}parseTokenOrUrl(e,t,i=2,r="dataset"){try{return et(e),[t,e]}catch(e){}try{let a=new URL(e).pathname.split("/").filter(e=>""!==e);if(a.length>=i){let e=a[a.length-i];return[t,e]}throw Error(`Invalid public ${r} URL: ${e}`)}catch(t){throw Error(`Invalid public ${r} URL or token: ${e}`)}}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()]),void 0!==this.langSmithToOTELTranslator&&await D.getDefaultOTLPTracerComponents()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush()}}function eT(e){return"dataset_id"in e||"dataset_name"in e}var eA=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,eR=function(e){if(!("string"==typeof e&&eA.test(e)))throw TypeError("Invalid UUID");var t,i=new Uint8Array(16);return i[0]=(t=parseInt(e.slice(0,8),16))>>>24,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=255&t,i[4]=(t=parseInt(e.slice(9,13),16))>>>8,i[5]=255&t,i[6]=(t=parseInt(e.slice(14,18),16))>>>8,i[7]=255&t,i[8]=(t=parseInt(e.slice(19,23),16))>>>8,i[9]=255&t,i[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,i[11]=t/4294967296&255,i[12]=t>>>24&255,i[13]=t>>>16&255,i[14]=t>>>8&255,i[15]=255&t,i};function eN(e,t){return e<<t|e>>>32-t}var eP=function(e,t,i){function r(e,t,r,a){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],i=0;i<e.length;++i)t.push(e.charCodeAt(i));return t}(e)),"string"==typeof t&&(t=eR(t)),(null===(s=t)||void 0===s?void 0:s.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var s,n=new Uint8Array(16+e.length);if(n.set(t),n.set(e,t.length),(n=i(n))[6]=15&n[6]|80,n[8]=63&n[8]|128,r){a=a||0;for(var o=0;o<16;++o)r[a+o]=n[o];return r}return d(n)}try{r.name="v5"}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}(0,0,function(e){var t=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var a=0;a<r.length;++a)e.push(r.charCodeAt(a))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var s=Math.ceil((e.length/4+2)/16),n=Array(s),o=0;o<s;++o){for(var l=new Uint32Array(16),u=0;u<16;++u)l[u]=e[64*o+4*u]<<24|e[64*o+4*u+1]<<16|e[64*o+4*u+2]<<8|e[64*o+4*u+3];n[o]=l}n[s-1][14]=(e.length-1)*8/4294967296,n[s-1][14]=Math.floor(n[s-1][14]),n[s-1][15]=(e.length-1)*8&4294967295;for(var h=0;h<s;++h){for(var d=new Uint32Array(80),c=0;c<16;++c)d[c]=n[h][c];for(var p=16;p<80;++p)d[p]=eN(d[p-3]^d[p-8]^d[p-14]^d[p-16],1);for(var m=i[0],f=i[1],_=i[2],g=i[3],b=i[4],y=0;y<80;++y){var v=Math.floor(y/20),w=eN(m,5)+function(e,t,i,r){switch(e){case 0:return t&i^~t&r;case 1:case 3:return t^i^r;case 2:return t&i^t&r^i&r}}(v,f,_,g)+b+t[v]+d[y]>>>0;b=g,g=_,_=eN(f,30)>>>0,f=m,m=w}i[0]=i[0]+m>>>0,i[1]=i[1]+f>>>0,i[2]=i[2]+_>>>0,i[3]=i[3]+g>>>0,i[4]=i[4]+b>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,255&i[0],i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,255&i[1],i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,255&i[2],i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,255&i[3],i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,255&i[4]]});let ej=e=>void 0!==e?e:!!["TRACING_V2","TRACING"].find(e=>"true"===T(e)),ex=Symbol.for("lc:context_variables"),eC=()=>T("PROJECT")??O("LANGCHAIN_SESSION")??"default";class eL{constructor(e,t,i,r){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=i,this.replicas=r}static fromHeader(e){let t,i;let r=e.split(","),a={},s=[];for(let e of r){let[r,n]=e.split("="),o=decodeURIComponent(n);"langsmith-metadata"===r?a=JSON.parse(o):"langsmith-tags"===r?s=o.split(","):"langsmith-project"===r?t=o:"langsmith-replicas"===r&&(i=JSON.parse(o))}return new eL(a,s,t,i)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class eU{constructor(e){var t;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),void 0!==e&&"function"==typeof e.createChild&&"function"==typeof e.postRun){Object.assign(this,{...e});return}let i=eU.getDefaultConfig(),{metadata:r,...a}=e,s=a.client??eU.getSharedClient(),n={...r,...a?.extra?.metadata};if(a.extra={...a.extra,metadata:n},Object.assign(this,{...i,...a,client:s}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=(t=this.replicas)?t.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):function(){let e=O("LANGSMITH_RUNS_ENDPOINTS");if(!e)return[];try{let t=JSON.parse(e);if(Array.isArray(t)){let e=[];for(let i of t){if("object"!=typeof i||null===i){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof i}`);continue}if("string"!=typeof i.api_url){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof i.api_url}`);continue}if("string"!=typeof i.api_key){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof i.api_key}`);continue}e.push({apiUrl:i.api_url.replace(/\/$/,""),apiKey:i.api_key})}return e}if("object"!=typeof t||null===t)return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS – must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof t}`),[];{(function(e){if(Object.keys(e).length>0&&T("ENDPOINT"))throw new el})(t);let e=[];for(let[i,r]of Object.entries(t)){let t=i.replace(/\/$/,"");if("string"==typeof r)e.push({apiUrl:t,apiKey:r});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${i}: expected string, got ${typeof r}`);continue}}return e}}catch(e){if("object"==typeof e&&null!==e&&e.code===eo)throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS – must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}(),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){let{dottedOrder:e,microsecondPrecisionDatestring:t}=function(e,t,i=1){let r=i.toFixed(0).slice(0,3).padStart(3,"0"),a=`${new Date(e).toISOString().slice(0,-1)}${r}Z`;return{dottedOrder:a.replace(/[-:.]/g,"")+t,microsecondPrecisionDatestring:a}}(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e,this._serialized_start_time=t}}set metadata(e){this.extra={...this.extra,metadata:{...this.extra?.metadata,...e}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){return{id:c(),run_type:"chain",project_name:eC(),child_runs:[],api_url:O("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:O("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return eU.sharedClient||(eU.sharedClient=new eO),eU.sharedClient}createChild(e){var t;let i=this.child_execution_order+1,r=new eU({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:i,child_execution_order:i});ex in this&&(r[ex]=this[ex]);let a=Symbol.for("lc:child_config"),s=e.extra?.[a]??this.extra[a];if(void 0!==s&&"object"==typeof s.callbacks&&(eD(s.callbacks?.handlers)||eD(s.callbacks))){let e={...s},i="object"==typeof(t=e.callbacks)&&null!=t&&Array.isArray(t.handlers)?e.callbacks.copy?.():void 0;i&&(Object.assign(i,{_parentRunId:r.id}),i.handlers?.find(ek)?.updateFromRunTree?.(r),e.callbacks=i),r.extra[a]=e}let n=new Set,o=this;for(;null!=o&&!n.has(o.id);)n.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,i),o=o.parent_run;return this.child_runs.push(r),r}async end(e,t,i=Date.now(),r){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??i,r&&Object.keys(r).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...r}}:{metadata:r})}_convertToCreate(e,t,i=!0){let r,a;let s=e.extra??{};if(s?.runtime?.library===void 0&&(s.runtime||(s.runtime={}),t))for(let[e,i]of Object.entries(t))s.runtime[e]||(s.runtime[e]=i);return i?(a=e.parent_run?.id??e.parent_run_id,r=[]):(r=e.child_runs.map(e=>this._convertToCreate(e,t,i)),a=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:r,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,i=!0){let r;let a=this._convertToCreate(this,t,i);if(e===this.project_name)return a;let s=t=>eP(`${t}:${e}`,eP.DNS),n=s(a.id),o=a.trace_id?s(a.trace_id):void 0,l=a.parent_run_id?s(a.parent_run_id):void 0;if(a.dotted_order){let e=a.dotted_order.split(".").map(e=>{let t=e.slice(0,-36),i=e.slice(-36),r=parseInt(t.slice(0,4)),a=parseInt(t.slice(4,6))-1,s=parseInt(t.slice(6,8)),n=parseInt(t.slice(9,11));return[new Date(r,a,s,n,parseInt(t.slice(11,13)),parseInt(t.slice(13,15)),parseInt(t.slice(15,21))/1e3),i]}),t=[];for(let i=0;i<e.length-1;i++){let[r,a]=e[i],n=s(a);t.push(r.toISOString().replace(/[-:]/g,"").replace(".","")+n)}let[i]=e[e.length-1];t.push(i.toISOString().replace(/[-:]/g,"").replace(".","")+n),r=t.join(".")}else r=void 0;return{...a,id:n,trace_id:o,parent_run_id:l,dotted_order:r,session_name:e}}async postRun(e=!0){try{let t=S();if(this.replicas&&this.replicas.length>0)for(let{projectName:e,apiKey:i,apiUrl:r}of this.replicas){let a=this._remapForProject(e??this.project_name,t,!0);await this.client.createRun(a,{apiKey:i,apiUrl:r})}else{let i=this._convertToCreate(this,t,e);await this.client.createRun(i)}if(!e)for(let e of(er("Posting with excludeChildRuns=false is deprecated and will be removed in a future version."),this.child_runs))await e.postRun(!1)}catch(e){console.error(`Error in postRun for run ${this.id}:`,e)}}async patchRun(){if(this.replicas&&this.replicas.length>0)for(let{projectName:e,apiKey:t,apiUrl:i,updates:r}of this.replicas){let a=this._remapForProject(e??this.project_name);await this.client.updateRun(a.id,{inputs:a.inputs,outputs:a.outputs,error:a.error,parent_run_id:a.parent_run_id,session_name:a.session_name,reference_example_id:a.reference_example_id,end_time:a.end_time,dotted_order:a.dotted_order,trace_id:a.trace_id,events:a.events,tags:a.tags,extra:a.extra,attachments:this.attachments,...r},{apiKey:t,apiUrl:i})}else try{let e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};await this.client.updateRun(this.id,e)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),"string"==typeof e?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){let i,r,a;let s=e?.callbacks,n=ej();if(s){let e=s?.getParentRunId?.()??"",t=s?.handlers?.find(e=>e?.name=="langchain_tracer");i=t?.getRun?.(e),r=t?.projectName,a=t?.client,n=n||!!t}return i?new eU({name:i.name,id:i.id,trace_id:i.trace_id,dotted_order:i.dotted_order,client:a,tracingEnabled:n,project_name:r,tags:[...new Set((i?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...i?.extra?.metadata,...e?.metadata}}}).createChild(t):new eU({...t,client:a,tracingEnabled:n,project_name:r})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let i="get"in e&&"function"==typeof e.get?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,r=i["langsmith-trace"];if(!r||"string"!=typeof r)return;let a=r.trim(),s=a.split(".").map(e=>{let[t,i]=e.split("Z");return{strTime:t,time:Date.parse(t+"Z"),uuid:i}}),n=s[0].uuid,o={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:s.at(-1)?.uuid,trace_id:n,dotted_order:a};if(i.baggage&&"string"==typeof i.baggage){let e=eL.fromHeader(i.baggage);o.metadata=e.metadata,o.tags=e.tags,o.project_name=e.project_name,o.replicas=e.replicas}return new eU(o)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new eL(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(let[i,r]of Object.entries(t))e.set(i,r);return t}}function ek(e){return"object"==typeof e&&null!=e&&"string"==typeof e.name&&"langchain_tracer"===e.name}function eD(e){return Array.isArray(e)&&e.some(e=>ek(e))}Object.defineProperty(eU,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});let eM="0.3.59"}}]);